<project name="Update DVT" default="installDVT">
	<target name="init" depends="record">
		<property name="eclipse_dir" value="${plugin_dir}/../.." />
		<condition property="eclipse_dir_set" value="true">
			<not>
				<equals arg1="${eclipse_dir}" arg2=""/>
			</not>
		</condition>
		<dirset dir="${eclipse_dir}/plugins" id="ant_dir_id">
			<include name="org.apache.ant*"/>
		</dirset>
		<pathconvert property="ant_dir" refid="ant_dir_id"/>
		
		<echo message="JRE version = ${java.version}"/>
		<echo message="ant dir = ${plugin_dir}"/>	
		<echo message="plugin_dir = ${plugin_dir}"/>
		<echo message="eclipse_dir = ${eclipse_dir}"/>
		<echo message="ant_dir = ${ant_dir}"/>
		
		<property file="dvt.installed"/>
	</target>
	
	<target name="createLogDir">
		<mkdir dir="${log_dir}"/>
	</target>
	
	<target name="logDir">
		<!-- need to get the correct version number -->
		<dirname property="plugin_dir" file="${ant.file}"/>
		<basename property="plugin_name" file="${plugin_dir}"/>
		<basename property="type" file="${ant.file}" suffix="xml"/>
		<property name="logfile" value="${user.home}/.TI/com.ti.dvt/${plugin_name}_${type}.log"/>
		<dirname property="log_dir" file="${logfile}"/>
		<subant antfile="${ant.file}" target="createLogDir" inheritall="true" failonerror="false" buildpath="."/>
		<available property="log_dir_found" file="${log_dir}" type="dir"/>
	</target>
	
	<target name="record" depends="logDir" if="log_dir_found">
		<record name="${logfile}"/>
	</target>
	
	<target name="getCCStudioDir" if="eclipse_dir_set">
		<loadproperties srcFile="${eclipse_dir}/ccs.properties"/>
		<property name="ccs.debugServerDir" value="${path}"/>

		<echo message="ccs.debugServerDir = ${ccs.debugServerDir}"/>
	</target>

	<target name="installDVT" depends="init,getCCStudioDir" unless="dvt.installed">		
		<propertyfile file="dvt.installed">
			<entry key="dvt.installed" value="true"/>
		</propertyfile>
		
		<condition property="dest_dir" value="${ccs.debugServerDir}/../dvt">
			<isset property="ccs.debugServerDir"/>
		</condition>
		<condition property="dest_dir" value="${eclipse_dir}/../dvt">
			<not>
				<isset property="ccs.debugServerDir"/>
			</not>
		</condition>

		<echo message="dest_dir = ${dest_dir}_4.1.0.202307061549"/>

		<unzip src="${plugin_dir}/dvt.zip" dest="${dest_dir}_4.1.0.202307061549/.." overwrite="true"/>
		<copy file="${ant_dir}/lib/ant.jar" todir="${dest_dir}_4.1.0.202307061549/../dvt/scripting" overwrite="true" failonerror="false"/>
		<copy file="${ant_dir}/lib/ant-launcher.jar" todir="${dest_dir}_4.1.0.202307061549/../dvt/scripting" overwrite="true" failonerror="false"/>
	</target>
</project>