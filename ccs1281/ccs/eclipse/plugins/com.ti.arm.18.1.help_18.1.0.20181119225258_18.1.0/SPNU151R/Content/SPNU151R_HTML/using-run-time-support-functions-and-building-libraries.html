<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" data-mc-search-type="Stem" data-mc-help-system-file-name="index.xml" data-mc-path-to-help-system="../../" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta charset="utf-8" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>7 Using Run-Time-Support Functions and Building Libraries</title>
        <link href="../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../Resources/Stylesheets/headerfooter.css" rel="stylesheet" />
        <script src="../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../Resources/Scripts/foundation.min.js">
        </script>
        <script src="../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <div class="content">
            <div id="contentBody">
                <div class="row collapse">
                    <div class="sideContent">
                        <div class="clearfix">
                        </div>
                    </div>
                    <div id="loadContentArea">
                        <div class="c12 docHeader">
                            <div class="c4 docTitle">
                                <p>
                                    <strong>ARM Optimizing
							C/C++ Compiler
			v18.1.0.LTS User's Guide</strong>
                                    <br />
                                    <span id="litnumber">SPNU151R</span> - REVISED JANUARY 2018</p>
                            </div>
                        </div>
                    </div>
                    <div class="odsHeader">
                        <p class="pdf">
                            <a class="downloadPDF" href="http://www.ti.com/litv/SPNU151R" target="_new">Download PDF</a>
                        </p>
                    </div>
                    <div id="loadContentArea1">
                        <div class="subsection">
                            <h2 id="STDZ0533709">
                                <a MadCap:generatedBookmark="TOC" name="7_Using_Run-Time-Support_Functions_and_Building_Libraries">
                                </a>
                                <span class="section-label">7 </span>Using Run-Time-Support Functions and Building Libraries</h2>
                            <div class="subsection">
                                <p> Some of the features of C/C++ (such as I/O, dynamic memory allocation, string operations, and trigonometric functions) are provided as an ANSI/ISO C/C++ standard library, rather than as part of the compiler itself. The TI implementation of this library is the run-time-support library (RTS). The C/C++ compiler implements the ISO standard library except for those facilities that handle <span>exception conditions, signal and </span>locale issues (properties that depend on local language, nationality, or culture). Using the ANSI/ISO standard library ensures a consistent set of functions that provide for greater portability. </p>
                                <p>In addition to the ANSI/ISO-specified functions, the run-time-support library includes routines that give you processor-specific commands and direct C language I/O requests. These are detailed in <span class="crossreference"><a href="#STDZ0533926">Section 7.1</a></span> and <span class="crossreference"><a href="#STDZ0536526">Section 7.2</a></span>.</p>
                                <p>A library-build utility is provided with the code generation tools that lets you create customized run-time-support libraries. This process is described in <span class="crossreference"><a href="#STDZ0538278">Section 7.4</a></span> .</p>
                            </div>
                            <div class="subsection">
                                <h3 id="STDZ0533926">
                                    <a MadCap:generatedBookmark="TOC" name="7.1_C_and_C++_Run-Time_Support_Libraries">
                                    </a>
                                    <span class="section-label">7.1 </span>C and C++ Run-Time Support Libraries</h3>
                                <p>
                                    <span>ARM</span> compiler releases include pre-built run-time support (RTS) libraries that provide all the standard capabilities. Separate libraries are provided for <span>each mode, big and little endian support, each ABI (compiler version 4.1.0 and later), various architectures, and</span> C++ exception support. See <span class="crossreference"><a href="#STDZ0535426">Section 7.1.8</a></span> for information on the library-naming conventions.</p>
                                <p>The run-time-support library contains the following:</p>
                                <ul>
                                    <li value="1">ANSI/ISO C/C++ standard library</li>
                                    <li value="2">C I/O library</li>
                                    <li value="3">Low-level support functions that provide I/O to the host operating system</li>
                                    <li value="4">Fundamental arithmetic routines</li>
                                    <li value="5">System startup routine, _c_int00</li>
                                    <li value="6">Compiler helper functions (to support language features that are not directly efficiently expressible in C/C++)</li>
                                </ul>
                                <p>The run-time-support libraries do not contain functions involving signals and locale issues.</p>
                                <p>The C++ library supports wide chars, in that template functions and classes that are defined for char are also available for wide char. For example, wide char stream classes wios, wiostream, wstreambuf and so on (corresponding to char classes ios, iostream, streambuf) are implemented. However, there is no low-level file I/O for wide chars. Also, the C library interface to wide char support (through the C++ headers &lt;cwchar&gt; and &lt;cwctype&gt;) is limited as described in <span class="crossreference"><a href="arm-c-c-language-implementation.html#STDZ0555774">Section 5.1</a></span>.</p>
                                <p>TI does not provide documentation that covers the functionality of the C++ library. TI suggests referring to one of the following sources:</p>
                                <ul>
                                    <li value="1">
                                        <i>The Standard C++ Library: A Tutorial and Reference</i>,Nicolai M. Josuttis, Addison-Wesley, ISBN 0-201-37926-0 </li>
                                    <li value="2">
                                        <i>The C++ Programming Language </i> (Third or Special Editions), Bjarne Stroustrup, Addison-Wesley, ISBN 0-201-88954-4 or 0-201-70073-5</li>
                                </ul>
                                <div class="subsection">
                                    <h4 id="STDZ0530914">
                                        <a MadCap:generatedBookmark="TOC" name="7.1.1_Linking_Code_With_the_Object_Library">
                                        </a>
                                        <span class="section-label">7.1.1 </span>Linking Code With the Object Library</h4>
                                    <p> When you link your program, you must specify the object library as one of the linker input files so that references to the I/O and run-time-support functions can be resolved. You can either specify the library or allow the compiler to select one for you. See <span class="crossreference"><a href="linking-c-c-code.html#STDZ0562451">Section 4.3.1</a></span> for further information.</p>
                                    <p>When a library is linked, the linker includes only those library members required to resolve undefined references. For more information about linking, see the<i> <span>ARM</span> Assembly Language Tools User's Guide</i>.</p>
                                    <p>C, C++, and mixed C and C++ programs can use the same run-time-support library. Run-time-support functions and variables that can be called and referenced from both C and C++ will have the same linkage.</p>
                                    <p>If you want to link object files created with the TI CodeGen tools with object files generated by other compiler tool chains, the ARM standard specifies that you should define the _AEABI_PORTABILITY_LEVEL preprocessor symbol as follows before #including any standard header files, such as &lt;stdlib.h&gt;.</p>
                                    <code>#define _AEABI_PORTABILITY_LEVEL 1</code>
                                    <p>This definition enables full portability. Defining the symbol to 0 specifies that the "C standard" portability level will be used.</p>
                                </div>
                                <div class="subsection">
                                    <h4 id="STDZ0525890">
                                        <a MadCap:generatedBookmark="TOC" name="7.1.2_Header_Files">
                                        </a>
                                        <span class="section-label">7.1.2 </span>Header Files</h4>
                                    <p>You must use the header files provided with the compiler run-time support when using functions from C/C++ standard library. Set the <span>TI_ARM_C_DIR</span> environment variable to the <span>include directory where the tools are installed.</span></p>
                                    <p>The following header files provide TI extensions to the C standard: </p>
                                    <ul>
                                        <li value="1"> cpy_tbl.h -- Declares the copy_in() RTS function, which is used to move code or data from a load location to a separate run location at run-time. This function helps manage overlays.</li>
                                        <li value="2">file.h -- Declares functions used by low-level I/O functions in the RTS library.</li>
                                        <li value="3">_lock.h -- Used when declaring system-wide mutex locks. This header file is deprecated; use _reg_mutex_api.h and _mutex.h instead.</li>
                                        <li value="4">memory.h -- Provides the memalign() function, which is not required by the C standard.</li>
                                        <li value="5"> _mutex.h -- Declares functions used by the RTS library to help facilitate mutexes for specific resources that are owned by the RTS. For example, these functions are used for heap or file table allocation. </li>
                                        <li value="6"> _pthread.h -- Declares low-level mutex infrastructure functions and provides support for recursive mutexes.</li>
                                        <li value="7"> _reg_mutex_api.h -- Declares a function that can be used by an RTOS to register an underlying lock mechanism and/or thread ID mechanism that is implemented in the RTOS but is called indirectly by the RTS’ _mutex.h functions. </li>
                                        <li value="8"> _reg_synch_api.h -- Declares a function that can be used by an RTOS to register an underlying cache synchronization mechanism that is implemented in the RTOS but is called indirectly by the RTS’ _data_synch.h functions. </li>
                                        <li value="9"> strings.h -- Provides additional string functions, including bcmp(), bcopy(), bzero(), ffs(), index(), rindex(), strcasecmp(), and strncasecmp().</li>
                                    </ul>
                                </div>
                                <div class="subsection">
                                    <h4 id="STDZ0530915">
                                        <a MadCap:generatedBookmark="TOC" name="7.1.3_Modifying_a_Library_Function">
                                        </a>
                                        <span class="section-label">7.1.3 </span>Modifying a Library Function</h4>
                                    <p> You can inspect or modify library functions by examining the source code in the lib/src subdirectory of the compiler installation. For example, <span class="code">C:\ti\ccsv6\tools\compiler\<span>arm_#.#.#</span>\lib\src</span>.</p>
                                    <p>One you have located the relevant source code, change the specific function file and rebuild the library.</p>
                                    <p>You can use this source tree to rebuild the <span>rtsv4_A_be_eabi.lib</span> library or to build a new library. See <span class="crossreference"><a href="#STDZ0538278">Section 7.4</a></span> for details on building.</p>
                                </div>
                                <div class="subsection">
                                    <h4 id="HTMLI039247">
                                        <a MadCap:generatedBookmark="TOC" name="7.1.4_Support_for_String_Handling">
                                        </a>
                                        <span class="section-label">7.1.4 </span>Support for String Handling</h4>
                                    <p>The library includes the header files &lt;string.h&gt; and &lt;strings.h&gt;, which provide the following functions for string handling beyond those required.</p>
                                    <ul>
                                        <li value="1">string.h<ul><li value="1">strdup(), which duplicates a string</li></ul></li>
                                        <li value="2">strings.h<ul><li value="1">bcmp(), which is equivalent to memcmp()</li><li value="2">bcopy(), which is equivalent to memmove()</li><li value="3"> bzero(), which replaces memory locations with zero-valued bytes</li><li value="4"> ffs(), which finds the first bit set and returns the index of that bit</li><li value="5">index(), which is equivalent to strchr()</li><li value="6">rindex(), which is equivalent to strrchr()</li><li value="7">strcasecmp() and strncasecmp(), which perform case-insensitive string comparisons</li></ul></li>
                                    </ul>
                                </div>
                                <div class="subsection">
                                    <h4 id="STDZ0531056">
                                        <a MadCap:generatedBookmark="TOC" name="7.1.5_Minimal_Support_for_Internationalization">
                                        </a>
                                        <span class="section-label">7.1.5 </span>Minimal Support for Internationalization</h4>
                                    <p>The library includes the header files &lt;locale.h&gt;, &lt;wchar.h&gt;, and &lt;wctype.h&gt;, which provide APIs to support non-ASCII character sets and conventions. Our implementation of these APIs is limited in the following ways:</p>
                                    <ul>
                                        <li value="1">The library has minimal support for wide and multibyte characters. The type wchar_t is implemented as <span>int</span>. The wide character set is equivalent to the set of values of type char. The library includes the header files &lt;wchar.h&gt; and &lt;wctype.h&gt; but does not include all the functions specified in the standard. So-called multibyte characters are limited to single characters. There are no shift states. The mapping between multibyte characters and wide characters is simple equivalence; that is, each wide character maps to and from exactly a single multibyte character having the same value.</li>
                                        <li value="2">The C library includes the header file &lt;locale.h&gt; but with a minimal implementation. The only supported locale is the C locale. That is, library behavior that is specified to vary by locale is hard-coded to the behavior of the C locale, and attempting to install a different locale via a call to setlocale() will return NULL.</li>
                                    </ul>
                                </div>
                                <div class="subsection">
                                    <h4 id="STDZ0535844">
                                        <a MadCap:generatedBookmark="TOC" name="7.1.6_Allowable_Number_of_Open_Files">
                                        </a>
                                        <span class="section-label">7.1.6 </span>Allowable Number of Open Files</h4>
                                    <p>In the &lt;stdio.h&gt; header file, the value for the macro FOPEN_MAX has the value of the macro _NFILE, which is set to 10. The impact is that you can only have 10 files simultaneously open at one time (including the pre-defined streams - stdin, stdout, stderr).</p>
                                    <p>The C standard requires that the minimum value for the FOPEN_MAX macro is 8. The macro determines the maximum number of files that can be opened at one time. The macro is defined in the stdio.h header file and can be modified by changing the value of the _NFILE macro and recompiling the library.</p>
                                </div>
                                <div class="subsection">
                                    <h4 id="STDZ0538067">
                                        <a MadCap:generatedBookmark="TOC" name="7.1.7_Nonstandard_Header_Files_in_the_Source_Tree">
                                        </a>
                                        <span class="section-label">7.1.7 </span>Nonstandard Header Files in the Source Tree</h4>
                                    <p>The source code in the lib/src subdirectory of the compiler installation contains these non-ANSI include files that are used to build the library:</p>
                                    <ul>
                                        <li value="1">The <i>values.h</i> file contains the definitions necessary for recompiling the trigonometric and transcendental math functions. If necessary, you can customize the functions in values.h. </li>
                                        <li value="2">The <i>file.h</i> file includes macros and definitions used for low-level I/O functions.</li>
                                        <li value="3">The <i>format.h</i> file includes structures and macros used in printf and scanf.</li>
                                        <li value="4">The <i>470cio.h</i> file includes low-level, target-specific C I/O macro definitions. If necessary, you can customize 470cio.h.</li>
                                        <li value="5">The <i>rtti.h</i> file includes internal function prototypes necessary to implement run-time type identification.</li>
                                        <li value="6">The <i>vtbl.h</i> file contains the definition of a class's virtual function table format. </li>
                                    </ul>
                                </div>
                                <div class="subsection">
                                    <h4 id="STDZ0535426">
                                        <a MadCap:generatedBookmark="TOC" name="7.1.8_Library_Naming_Conventions">
                                        </a>
                                        <span class="section-label">7.1.8 </span>Library Naming Conventions</h4>
                                    <p>By default, the linker uses automatic library selection to select the correct run-time-support library (see <span class="crossreference"><a href="linking-c-c-code.html#STDZ0564809">Section 4.3.1.1</a></span>) for your application. If you select the library manually, you must select the matching library according to the following naming scheme:</p>
                                    <p>
                                        <i>rtsArchVersion_mode_endian</i>[_n][_v<i>n</i>]_<i>abi</i>[_eh].lib</p>
                                    <div class="subsection">
                                        <table class="tabbedtext">
                                            <colgroup>
                                                <col />
                                                <col />
                                                <col />
                                            </colgroup>
                                            <tbody>
                                                <tr>
                                                    <td> <i>ArchVersion</i> <![CDATA[ ]]></td>
                                                    <td colspan="2">The version of the ARM architecture that the library was built for. This can be one of the following: v4, v5, v6, v6M0, v7A8, v7R4, v7R5, or v7M3.</td>
                                                </tr>
                                                <tr>
                                                    <td rowspan="3"> <i>mode</i> <![CDATA[ ]]></td>
                                                    <td colspan="2">Indicates compilation mode:</td>
                                                </tr>
                                                <tr>
                                                    <td>T</td>
                                                    <td>Thumb mode</td>
                                                </tr>
                                                <tr>
                                                    <td>A</td>
                                                    <td>ARM mode</td>
                                                </tr>
                                                <tr>
                                                    <td rowspan="3"> <i>endian</i> <![CDATA[ ]]></td>
                                                    <td colspan="2">Indicates endianness: </td>
                                                </tr>
                                                <tr>
                                                    <td>le</td>
                                                    <td>Little-endian library</td>
                                                </tr>
                                                <tr>
                                                    <td>be</td>
                                                    <td>Big-endian library</td>
                                                </tr>
                                                <tr>
                                                    <td>n</td>
                                                    <td colspan="2">Indicates the library contains NEON support.</td>
                                                </tr>
                                                <tr>
                                                    <td rowspan="4">v<i>n</i> <![CDATA[ ]]></td>
                                                    <td colspan="2">Indicates the library has VFP support, where <i>n</i> designates the version. Current values are:</td>
                                                </tr>
                                                <tr>
                                                    <td>2</td>
                                                    <td>VFPv2</td>
                                                </tr>
                                                <tr>
                                                    <td>3</td>
                                                    <td>VFPv3</td>
                                                </tr>
                                                <tr>
                                                    <td>3D16</td>
                                                    <td>VFPv3D16</td>
                                                </tr>
                                                <tr>
                                                    <td rowspan="2"> <i>abi</i> <![CDATA[ ]]></td>
                                                    <td colspan="2">Indicates the application binary interface (ABI) used. Although the TI_ARM9_ABI and TIARM ABIs are no longer supported, the library filename still contains "_eabi" to distinguish the EABI libraries from older libraries.</td>
                                                </tr>
                                                <tr>
                                                    <td>eabi</td>
                                                    <td />
                                                </tr>
                                                <tr>
                                                    <td> <i>eh</i> <![CDATA[ ]]></td>
                                                    <td colspan="2">Indicates the library has exception handling support</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <div class="subsection">
                                <h3 id="STDZ0536526">
                                    <a MadCap:generatedBookmark="TOC" name="7.2_The_C_I_O_Functions">
                                    </a>
                                    <span class="section-label">7.2 </span>The C I/O Functions</h3>
                                <p>The C I/O functions make it possible to access the host's operating system to perform I/O. The capability to perform I/O on the host gives you more options when debugging and testing code.</p>
                                <p> The I/O functions are logically divided into layers: high level, low level, and device-driver level.</p>
                                <p>With properly written device drivers, the C-standard high-level I/O functions can be used to perform I/O on custom user-defined devices. This provides an easy way to use the sophisticated buffering of the high-level I/O functions on an arbitrary device.</p>
                                <p>The formatting rules for long long data types require ll (lowercase LL) in the format string. For example:</p>
                                <code>printf("%lld", 0x0011223344556677);
printf("llx", 0x0011223344556677);</code>
                                <span class="note">
                                    <p class="note_title">NOTE</p>
                                    <b>Debugger Required for Default HOST</b>
                                    <p>For the default HOST device to work, there must be a debugger to handle the C I/O requests; the default HOST device cannot work by itself in an embedded system. To work in an embedded system, you will need to provide an appropriate driver for your system. </p>
                                </span>
                                <span class="note">
                                    <p class="note_title">NOTE</p>
                                    <p>
                                        <b>C I/O Mysteriously Fails</b>
                                    </p>
                                    <p>If there is not enough space on the heap for a C I/O buffer, operations on the file will silently fail. If a call to printf() mysteriously fails, this may be the reason. The heap needs to be at least large enough to allocate a block of size BUFSIZ (defined in stdio.h) for every file on which I/O is performed, including stdout, stdin, and stderr, plus allocations performed by the user's code, plus allocation bookkeeping overhead. Alternately, declare a char array of size BUFSIZ and pass it to setvbuf to avoid dynamic allocation. To set the heap size, use the --heap_size option when linking (refer to the <i>Linker Description</i> chapter in the <i><span>ARM </span> Assembly Language Tools User's Guide</i>).</p>
                                </span>
                                <span class="note">
                                    <p class="note_title">NOTE</p>
                                    <p>
                                        <b>Open Mysteriously Fails</b>
                                    </p>
                                    <p>The run-time support limits the total number of open files to a small number relative to general-purpose processors. If you attempt to open more files than the maximum, you may find that the open will mysteriously fail. You can increase the number of open files by extracting the source code from rts.src and editing the constants controlling the size of some of the C I/O data structures. The macro _NFILE controls how many FILE (fopen) objects can be open at one time (stdin, stdout, and stderr count against this total). (See also FOPEN_MAX.) The macro _NSTREAM controls how many low-level file descriptors can be open at one time (the low-level files underlying stdin, stdout, and stderr count against this total). The macro _NDEVICE controls how many device drivers are installed at one time (the HOST device counts against this total).</p>
                                </span>
                                <div class="subsection">
                                    <h4 id="STDZ0537762">
                                        <a MadCap:generatedBookmark="TOC" name="7.2.1_High-Level_I_O_Functions">
                                        </a>
                                        <span class="section-label">7.2.1 </span>High-Level I/O Functions</h4>
                                    <p>The high-level functions are the standard C library of stream I/O routines (printf, scanf, fopen, getchar, and so on). These functions call one or more low-level I/O functions to carry out the high-level I/O request. The high-level I/O routines operate on FILE pointers, also called <i>streams</i>.</p>
                                    <p>Portable applications should use only the high-level I/O functions.</p>
                                    <p>To use the high-level I/O functions:</p>
                                    <ul>
                                        <li value="1">Include the header file stdio.h for each module that references a function.</li>
                                        <li value="2">Allow for 320 bytes of heap space for each I/O stream used in your program. A stream is a source or destination of data that is associated with a peripheral, such as a terminal or keyboard. Streams are buffered using dynamically allocated memory that is taken from the heap. More heap space may be required to support programs that use additional amounts of dynamically allocated memory (calls to malloc()). To set the heap size, use the --heap_size option when linking; see <span class="crossreference"><a href="using-the-c-c-compiler.html#STDZ0754620">Table 2-21</a></span>.</li>
                                    </ul>
                                    <p>For example, given the following C program in a file named main.c:</p>
                                    <code>#include &lt;stdio.h&gt;void main()
{
 FILE *fid;

 fid = fopen("myfile","w");
 fprintf(fid,"Hello, world\n");
 fclose(fid);

 printf("Hello again, world\n");
}</code>
                                    <p>Issuing the following compiler command compiles, links, and creates the file main.out from the run-time-support library:</p>
                                    <code>armcl main.c --run_linker --heap_size=400 --library=rtsv4_A_be_eabi.lib --output_file=main.out</code>
                                    <p>Executing main.out results in</p>
                                    <code>Hello, world</code>
                                    <p>being output to a file and</p>
                                    <code>Hello again, world</code>
                                    <p>being output to your host's stdout window.</p>
                                </div>
                                <div class="subsection">
                                    <h4 id="STDZ0532876">
                                        <a MadCap:generatedBookmark="TOC" name="7.2.2_Overview_of_Low-Level_I_O_Implementation">
                                        </a>
                                        <span class="section-label">7.2.2 </span>Overview of Low-Level I/O Implementation</h4>
                                    <p>The low-level functions are comprised of seven basic I/O functions: open, read, write, close, lseek, rename, and unlink. These low-level routines provide the interface between the high-level functions and the device-level drivers that actually perform the I/O command on the specified device.</p>
                                    <p>The low-level functions are designed to be appropriate for all I/O methods, even those which are not actually disk files. Abstractly, all I/O channels can be treated as files, although some operations (such as lseek) may not be appropriate. See <span class="crossreference"><a href="#STDZ0537704">Section 7.2.3</a></span> for more details.</p>
                                    <p>The low-level functions are inspired by, but not identical to, the POSIX functions of the same names. </p>
                                    <p>The low-level functions operate on file descriptors. A file descriptor is an integer returned by open, representing an opened file. Multiple file descriptors may be associated with a file; each has its own independent file position indicator. </p>
                                    <div class="Module">
                                        <div class="ModItem">
                                            <div class="ModItemName" id="IDopen">open</div>
                                            <div class="ModItemDesc">Open File for I/O</div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Syntax</div>
                                                <div class="ModTermDesc">
                                                    <p>#include &lt;file.h&gt;</p>
                                                    <p>
                                                        <b>int open (const char *</b>
                                                        <i>path</i>
                                                        <b>, unsigned</b>
                                                        <i> flags</i>
                                                        <b>, int</b>
                                                        <i> file_descriptor</i>
                                                        <b>);</b>
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Description</div>
                                                <div class="ModTermDesc">
                                                    <p>The open function opens the file specified by <i>path</i> and prepares it for I/O.</p>
                                                    <ul>
                                                        <li value="1">The <i>path</i> is the filename of the file to be opened, including an optional directory path and an optional device specifier (see <span class="crossreference"><a href="#STDZ0535530">Section 7.2.5</a></span>).</li>
                                                        <li value="2">The <i>flags</i> are attributes that specify how the file is manipulated. The flags are specified using the following symbols:</li>
                                                        <code>   O_RDONLY (0x0000) /* open for reading */
 O_WRONLY (0x0001) /* open for writing */
 O_RDWR (0x0002) /* open for read &amp; write */
 O_APPEND (0x0008) /* append on each write */
 O_CREAT (0x0200) /* open with file create */
 O_TRUNC (0x0400) /* open with truncation */
 O_BINARY (0x8000) /* open in binary mode */</code>
                                                        <p>Low-level I/O routines allow or disallow some operations depending on the flags used when the file was opened. Some flags may not be meaningful for some devices, depending on how the device implements files.</p>
                                                        <li value="3">The <i>file_descriptor</i> is assigned by open to an opened file.</li>
                                                        <p>The next available file descriptor is assigned to each new file opened. </p>
                                                    </ul>
                                                </div>
                                            </div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Return Value</div>
                                                <div class="ModTermDesc">
                                                    <p>The function returns one of the following values:</p>
                                                    <div class="subsection">
                                                        <table class="tabbedtext">
                                                            <colgroup>
                                                                <col />
                                                                <col align="left" />
                                                            </colgroup>
                                                            <tbody>
                                                                <tr>
                                                                    <td align="left" class="noBorderRight noBorderBottom" valign="top">non-negative file descriptor</td>
                                                                    <td align="left" class="noBorderRight noBorderBottom" valign="top">if successful</td>
                                                                </tr>
                                                                <tr>
                                                                    <td align="left" class="noBorderRight noBorderBottom" valign="top">-1</td>
                                                                    <td align="left" class="noBorderRight noBorderBottom" valign="top">on failure</td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="ModItem">
                                            <div class="ModItemName" id="IDclose">close</div>
                                            <div class="ModItemDesc">Close File for I/O</div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Syntax</div>
                                                <div class="ModTermDesc">
                                                    <p> #include &lt;file.h&gt;</p>
                                                    <p>
                                                        <b>int close (int </b>
                                                        <i>file_descriptor</i>
                                                        <b>);</b>
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Description</div>
                                                <div class="ModTermDesc">
                                                    <p>The close function closes the file associated with <i>file_descriptor</i>.</p>
                                                    <p>The <i>file_descriptor</i> is the number assigned by open to an opened file.</p>
                                                </div>
                                            </div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Return Value</div>
                                                <div class="ModTermDesc">
                                                    <p>The return value is one of the following:</p>
                                                    <div class="subsection">
                                                        <table class="tabbedtext">
                                                            <colgroup>
                                                                <col />
                                                                <col align="left" />
                                                            </colgroup>
                                                            <tbody>
                                                                <tr>
                                                                    <td align="left" class="noBorderRight noBorderBottom" valign="top">0</td>
                                                                    <td align="left" class="noBorderRight noBorderBottom" valign="top">if successful</td>
                                                                </tr>
                                                                <tr>
                                                                    <td align="left" class="noBorderRight noBorderBottom" valign="top">-1</td>
                                                                    <td align="left" class="noBorderRight noBorderBottom" valign="top">on failure</td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="ModItem">
                                            <div class="ModItemName" id="IDread">read</div>
                                            <div class="ModItemDesc">Read Characters from a File</div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Syntax</div>
                                                <div class="ModTermDesc">
                                                    <p> #include &lt;file.h&gt;</p>
                                                    <p>
                                                        <b>int read (int</b>
                                                        <i>file_descriptor</i>
                                                        <b>, char *</b>
                                                        <i>buffer</i>
                                                        <b>, unsigned</b>
                                                        <i>count</i>
                                                        <b>);</b>
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Description</div>
                                                <div class="ModTermDesc">
                                                    <p>The read function reads <i>count</i> characters into the <i>buffer</i> from the file associated with <i>file_descriptor</i>.</p>
                                                    <ul>
                                                        <li value="1">The <i>file_descriptor</i> is the number assigned by open to an opened file.</li>
                                                        <li value="2">The <i>buffer</i> is where the read characters are placed.</li>
                                                        <li value="3">The <i>count</i> is the number of characters to read from the file.</li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Return Value</div>
                                                <div class="ModTermDesc">
                                                    <p>The function returns one of the following values:</p>
                                                    <div class="subsection">
                                                        <table class="tabbedtext">
                                                            <colgroup>
                                                                <col />
                                                                <col align="left" />
                                                            </colgroup>
                                                            <tbody>
                                                                <tr>
                                                                    <td align="left" class="noBorderRight noBorderBottom" valign="top">0</td>
                                                                    <td align="left" class="noBorderRight noBorderBottom" valign="top">if EOF was encountered before any characters were read</td>
                                                                </tr>
                                                                <tr>
                                                                    <td align="left" class="noBorderRight noBorderBottom" valign="top">#</td>
                                                                    <td align="left" class="noBorderRight noBorderBottom" valign="top">number of characters read (may be less than <i>count</i>)</td>
                                                                </tr>
                                                                <tr>
                                                                    <td align="left" class="noBorderRight noBorderBottom" valign="top">-1</td>
                                                                    <td align="left" class="noBorderRight noBorderBottom" valign="top">on failure</td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="ModItem">
                                            <div class="ModItemName" id="IDwrite">write</div>
                                            <div class="ModItemDesc">Write Characters to a File</div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Syntax</div>
                                                <div class="ModTermDesc">
                                                    <p> #include &lt;file.h&gt;</p>
                                                    <p>
                                                        <b>int write (int</b>
                                                        <i>file_descriptor</i>
                                                        <b>, const char *</b>
                                                        <i>buffer</i>
                                                        <b>, unsigned</b>
                                                        <i>count</i>
                                                        <b>);</b>
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Description</div>
                                                <div class="ModTermDesc">
                                                    <p>The write function writes the number of characters specified by <i>count</i> from the <i>buffer</i> to the file associated with <i>file_descriptor</i>.</p>
                                                    <ul>
                                                        <li value="1">The <i>file_descriptor</i> is the number assigned by open to an opened file.</li>
                                                        <li value="2">The <i>buffer</i> is where the characters to be written are located.</li>
                                                        <li value="3">The <i>count</i> is the number of characters to write to the file.</li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Return Value</div>
                                                <div class="ModTermDesc">
                                                    <p>The function returns one of the following values:</p>
                                                    <div class="subsection">
                                                        <table class="tabbedtext">
                                                            <colgroup>
                                                                <col />
                                                                <col align="left" />
                                                            </colgroup>
                                                            <tbody>
                                                                <tr>
                                                                    <td align="left" class="noBorderRight noBorderBottom" valign="top">#</td>
                                                                    <td align="left" class="noBorderRight noBorderBottom" valign="top">number of characters written if successful (may be less than <i>count</i>)</td>
                                                                </tr>
                                                                <tr>
                                                                    <td align="left" class="noBorderRight noBorderBottom" valign="top">-1</td>
                                                                    <td align="left" class="noBorderRight noBorderBottom" valign="top">on failure</td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="ModItem">
                                            <div class="ModItemName" id="IDlseek">lseek</div>
                                            <div class="ModItemDesc">Set File Position Indicator</div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Syntax for C</div>
                                                <div class="ModTermDesc">
                                                    <p>#include &lt;file.h&gt;</p>
                                                    <p>
                                                        <b>off_t lseek (int</b>
                                                        <i>file_descriptor</i>
                                                        <b>, off_t</b>
                                                        <i>offset</i>
                                                        <b>, int</b>
                                                        <i>origin</i>
                                                        <b>);</b>
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Description</div>
                                                <div class="ModTermDesc">
                                                    <p>The lseek function sets the file position indicator for the given file to a location relative to the specified origin. The file position indicator measures the position in characters from the beginning of the file.</p>
                                                    <ul>
                                                        <li value="1">The <i>file_descriptor</i> is the number assigned by open to an opened file.</li>
                                                        <li value="2">The <i>offset</i> indicates the relative offset from the <i>origin</i> in characters.</li>
                                                        <li value="3">The <i>origin</i> is used to indicate which of the base locations the <i>offset</i> is measured from. The <i>origin</i> must be one of the following macros:</li>
                                                        <p>
                                                            <b>SEEK_SET</b> (0x0000) Beginning of file</p>
                                                        <p>
                                                            <b>SEEK_CUR</b> (0x0001) Current value of the file position indicator</p>
                                                        <p>
                                                            <b>SEEK_END </b>(0x0002) End of file</p>
                                                    </ul>
                                                </div>
                                            </div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Return Value </div>
                                                <div class="ModTermDesc">
                                                    <p>The return value is one of the following:</p>
                                                    <div class="subsection">
                                                        <table class="tabbedtext">
                                                            <colgroup>
                                                                <col />
                                                                <col align="left" />
                                                            </colgroup>
                                                            <tbody>
                                                                <tr>
                                                                    <td align="left" class="noBorderRight noBorderBottom" valign="top"># </td>
                                                                    <td align="left" class="noBorderRight noBorderBottom" valign="top">new value of the file position indicator if successful</td>
                                                                </tr>
                                                                <tr>
                                                                    <td align="left" class="noBorderRight noBorderBottom" valign="top">(off_t)-1</td>
                                                                    <td align="left" class="noBorderRight noBorderBottom" valign="top">on failure</td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="ModItem">
                                            <div class="ModItemName" id="IDunlink">unlink</div>
                                            <div class="ModItemDesc">Delete File</div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Syntax</div>
                                                <div class="ModTermDesc">
                                                    <p>#include &lt;file.h&gt;</p>
                                                    <p>
                                                        <b>int unlink (const char *</b>
                                                        <i>path</i>
                                                        <b>);</b>
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Description</div>
                                                <div class="ModTermDesc">
                                                    <p>The unlink function deletes the file specified by <i>path</i>. Depending on the device, a deleted file may still remain until all file descriptors which have been opened for that file have been closed. See <span class="crossreference"><a href="#STDZ0537704">Section 7.2.3</a></span>.</p>
                                                    <p>The <i>path</i> is the filename of the file, including path information and optional device prefix. (See <span class="crossreference"><a href="#STDZ0535530">Section 7.2.5</a></span>.)</p>
                                                </div>
                                            </div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Return Value</div>
                                                <div class="ModTermDesc">
                                                    <p>The function returns one of the following values:</p>
                                                    <div class="subsection">
                                                        <table class="tabbedtext">
                                                            <colgroup>
                                                                <col />
                                                                <col align="left" />
                                                            </colgroup>
                                                            <tbody>
                                                                <tr>
                                                                    <td align="left" class="noBorderRight noBorderBottom" valign="top">0</td>
                                                                    <td align="left" class="noBorderRight noBorderBottom" valign="top">if successful</td>
                                                                </tr>
                                                                <tr>
                                                                    <td align="left" class="noBorderRight noBorderBottom" valign="top">-1</td>
                                                                    <td align="left" class="noBorderRight noBorderBottom" valign="top">on failure</td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="ModItem">
                                            <div class="ModItemName" id="IDrename">rename</div>
                                            <div class="ModItemDesc">Rename File</div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Syntax for C</div>
                                                <div class="ModTermDesc">
                                                    <p> #include {&lt;stdio.h&gt; | &lt;file.h&gt;}</p>
                                                    <p>
                                                        <b>int rename (const char *</b>
                                                        <i>old_name</i>
                                                        <b>, const char *</b>
                                                        <i>new_name</i>
                                                        <b>);</b>
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Syntax for C++</div>
                                                <div class="ModTermDesc">
                                                    <p>#include {&lt;cstdio&gt; | &lt;file.h&gt;}</p>
                                                    <p>
                                                        <b>int std::rename (const char *</b>
                                                        <i>old_name</i>
                                                        <b>, const char *</b>
                                                        <i>new_name</i>
                                                        <b>);</b>
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Description</div>
                                                <div class="ModTermDesc">
                                                    <p>The rename function changes the name of a file.</p>
                                                    <ul>
                                                        <li value="1">The <i>old_name</i> is the current name of the file.</li>
                                                        <li value="2">The <i>new_name</i> is the new name for the file.</li>
                                                        <span class="note">
                                                            <p class="note_title">NOTE</p>
                                                            <p>The optional device specified in the new name must match the device of the old name. If they do not match, a file copy would be required to perform the rename, and rename is not capable of this action.</p>
                                                        </span>
                                                    </ul>
                                                </div>
                                            </div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Return Value</div>
                                                <div class="ModTermDesc">
                                                    <p>
                                                        <b>
                                                        </b>The function returns one of the following values:</p>
                                                    <div class="subsection">
                                                        <table class="tabbedtext">
                                                            <colgroup>
                                                                <col />
                                                                <col align="left" />
                                                            </colgroup>
                                                            <tbody>
                                                                <tr>
                                                                    <td align="left" class="noBorderRight noBorderBottom" valign="top">0</td>
                                                                    <td align="left" class="noBorderRight noBorderBottom" valign="top">if successful</td>
                                                                </tr>
                                                                <tr>
                                                                    <td align="left" class="noBorderRight noBorderBottom" valign="top">-1</td>
                                                                    <td align="left" class="noBorderRight noBorderBottom" valign="top">on failure</td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                    <span class="note">
                                                        <p class="note_title">NOTE</p>
                                                        <p> Although rename is a low-level function, it is defined by the C standard and can be used by portable applications.</p>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="subsection">
                                    <h4 id="STDZ0537704">
                                        <a MadCap:generatedBookmark="TOC" name="7.2.3_Device-Driver_Level_I_O_Functions">
                                        </a>
                                        <span class="section-label">7.2.3 </span>Device-Driver Level I/O Functions</h4>
                                    <p>At the next level are the device-level drivers. They map directly to the low-level I/O functions. The default device driver is the HOST device driver, which uses the debugger to perform file operations. The HOST device driver is automatically used for the default C streams stdin, stdout, and stderr. </p>
                                    <p>The HOST device driver shares a special protocol with the debugger running on a host system so that the host can perform the C I/O requested by the program. Instructions for C I/O operations that the program wants to perform are encoded in a special buffer named _CIOBUF_ in the .cio section. The debugger halts the program at a special breakpoint (C$$IO$$), reads and decodes the target memory, and performs the requested operation. The result is encoded into _CIOBUF_, the program is resumed, and the target decodes the result. </p>
                                    <p>The HOST device is implemented with seven functions, HOSTopen, HOSTclose, HOSTread, HOSTwrite, HOSTlseek, HOSTunlink, and HOSTrename, which perform the encoding. Each function is called from the low-level I/O function with a similar name. </p>
                                    <p>A device driver is composed of seven required functions. Not all function need to be meaningful for all devices, but all seven must be defined. Here we show the names of all seven functions as starting with DEV, but you may choose any name except for HOST.</p>
                                    <div class="Module">
                                        <div class="ModItem">
                                            <div class="ModItemName" id="IDdev_open">DEV_open</div>
                                            <div class="ModItemDesc">Open File for I/O</div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Syntax</div>
                                                <div class="ModTermDesc">
                                                    <p>
                                                        <b>int DEV_open (const char *</b>
                                                        <i>path</i>
                                                        <b>, unsigned</b>
                                                        <i> flags</i>
                                                        <b>, int</b>
                                                        <i>llv_fd</i>
                                                        <b>);</b>
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Description</div>
                                                <div class="ModTermDesc">
                                                    <p>This function finds a file matching <i>path</i> and opens it for I/O as requested by <i>flags</i>. </p>
                                                    <ul>
                                                        <li value="1">The <i>path</i> is the filename of the file to be opened. If the name of a file passed to open has a device prefix, the device prefix will be stripped by open, so DEV_open will not see it. (See <span class="crossreference"><a href="#STDZ0535530">Section 7.2.5</a></span> for details on the device prefix.)</li>
                                                        <li value="2">The <i>flags</i> are attributes that specify how the file is manipulated. The flags are specified using the following symbols:</li>
                                                        <code>   O_RDONLY (0x0000) /* open for reading */
 O_WRONLY (0x0001) /* open for writing */
 O_RDWR (0x0002) /* open for read &amp; write */
 O_APPEND (0x0008) /* append on each write */
 O_CREAT (0x0200) /* open with file create */
 O_TRUNC (0x0400) /* open with truncation */
 O_BINARY (0x8000) /* open in binary mode */
</code>
                                                        <p>See POSIX for further explanation of the flags.</p>
                                                        <li value="3">The <i>llv_fd</i> is treated as a suggested low-level file descriptor. This is a historical artifact; newly-defined device drivers should ignore this argument. This differs from the low-level I/O open function.</li>
                                                    </ul>
                                                    <p>This function must arrange for information to be saved for each file descriptor, typically including a file position indicator and any significant flags. For the HOST version, all the bookkeeping is handled by the debugger running on the host machine. If the device uses an internal buffer, the buffer can be created when a file is opened, or the buffer can be created during a read or write. </p>
                                                </div>
                                            </div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Return Value</div>
                                                <div class="ModTermDesc">
                                                    <p>This function must return -1 to indicate an error if for some reason the file could not be opened; such as the file does not exist, could not be created, or there are too many files open. The value of errno may optionally be set to indicate the exact error (the HOST device does not set errno). Some devices might have special failure conditions; for instance, if a device is read-only, a file cannot be opened O_WRONLY. </p>
                                                    <p>On success, this function must return a non-negative file descriptor unique among all open files handled by the specific device. The file descriptor need not be unique across devices. The device file descriptor is used only by low-level functions when calling the device-driver-level functions. The low-level function <span class="code">open</span> allocates its own unique file descriptor for the high-level functions to call the low-level functions. Code that uses only high-level I/O functions need not be aware of these file descriptors.</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="ModItem">
                                            <div class="ModItemName" id="IDdev_close">DEV_close</div>
                                            <div class="ModItemDesc">Close File for I/O</div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Syntax</div>
                                                <div class="ModTermDesc">
                                                    <p>
                                                        <b>int DEV_close (int </b>
                                                        <i>dev_fd</i>
                                                        <b>);</b>
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Description</div>
                                                <div class="ModTermDesc">
                                                    <p>This function closes a valid open file descriptor.</p>
                                                    <p>On some devices, DEV_close may need to be responsible for checking if this is the last file descriptor pointing to a file that was unlinked. If so, it is responsible for ensuring that the file is actually removed from the device and the resources reclaimed, if appropriate. </p>
                                                </div>
                                            </div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Return Value</div>
                                                <div class="ModTermDesc">
                                                    <p>This function should return -1 to indicate an error if the file descriptor is invalid in some way, such as being out of range or already closed, but this is not required. The user should not call close() with an invalid file descriptor. </p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="ModItem">
                                            <div class="ModItemName" id="IDdev_read">DEV_read</div>
                                            <div class="ModItemDesc">Read Characters from a File</div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Syntax</div>
                                                <div class="ModTermDesc">
                                                    <p>
                                                        <b>int DEV_read (int</b>
                                                        <i>dev_fd</i>
                                                        <b>, char *</b>
                                                        <i>buf</i>
                                                        <b>, unsigned</b>
                                                        <i>count</i>
                                                        <b>);</b>
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Description</div>
                                                <div class="ModTermDesc">
                                                    <p>The read function reads <i>count</i> bytes from the input file associated with <i>dev_fd</i>.</p>
                                                    <ul>
                                                        <li value="1">The <i>dev_fd</i> is the number assigned by open to an opened file.</li>
                                                        <li value="2">The <i>buf</i> is where the read characters are placed.</li>
                                                        <li value="3">The <i>count</i> is the number of characters to read from the file.</li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Return Value</div>
                                                <div class="ModTermDesc">
                                                    <p>This function must return -1 to indicate an error if for some reason no bytes could be read from the file. This could be because of an attempt to read from a O_WRONLY file, or for device-specific reasons. </p>
                                                    <p>If count is 0, no bytes are read and this function returns 0. </p>
                                                    <p>This function returns the number of bytes read, from 0 to count. 0 indicates that EOF was reached before any bytes were read. It is not an error to read less than count bytes; this is common if the are not enough bytes left in the file or the request was larger than an internal device buffer size. </p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="ModItem">
                                            <div class="ModItemName" id="IDdev_write">DEV_write</div>
                                            <div class="ModItemDesc">Write Characters to a File</div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Syntax</div>
                                                <div class="ModTermDesc">
                                                    <p>
                                                        <b>int DEV_write (int</b>
                                                        <i>dev_fd</i>
                                                        <b>, const char *</b>
                                                        <i>buf</i>
                                                        <b>, unsigned</b>
                                                        <i>count</i>
                                                        <b>);</b>
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Description</div>
                                                <div class="ModTermDesc">
                                                    <p>This function writes <i>count</i> bytes to the output file.</p>
                                                    <ul>
                                                        <li value="1">The <i>dev_fd</i> is the number assigned by open to an opened file.</li>
                                                        <li value="2">The <i>buffer</i> is where the write characters are placed.</li>
                                                        <li value="3">The <i>count</i> is the number of characters to write to the file.</li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Return Value</div>
                                                <div class="ModTermDesc">
                                                    <p>This function must return -1 to indicate an error if for some reason no bytes could be written to the file. This could be because of an attempt to read from a O_RDONLY file, or for device-specific reasons. </p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="ModItem">
                                            <div class="ModItemName" id="IDdev_lseek">DEV_lseek</div>
                                            <div class="ModItemDesc">Set File Position Indicator</div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Syntax</div>
                                                <div class="ModTermDesc">
                                                    <p>
                                                        <b>off_t lseek (int</b>
                                                        <i>dev_fd</i>
                                                        <b>, off_t</b>
                                                        <i>offset</i>
                                                        <b>, int</b>
                                                        <i>origin</i>
                                                        <b>);</b>
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Description</div>
                                                <div class="ModTermDesc">
                                                    <p>This function sets the file's position indicator for this file descriptor as <span class="crossreference"><a href="#IDlseek">lseek</a></span>. </p>
                                                    <p>If lseek is supported, it should not allow a seek to before the beginning of the file, but it should support seeking past the end of the file. Such seeks do not change the size of the file, but if it is followed by a write, the file size will increase. </p>
                                                </div>
                                            </div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Return Value</div>
                                                <div class="ModTermDesc">
                                                    <p>If successful, this function returns the new value of the file position indicator. </p>
                                                    <p>This function must return -1 to indicate an error if for some reason no bytes could be written to the file. For many devices, the lseek operation is nonsensical (e.g. a computer monitor). </p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="ModItem">
                                            <div class="ModItemName" id="IDdev_unlink">DEV_unlink</div>
                                            <div class="ModItemDesc">Delete File</div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Syntax</div>
                                                <div class="ModTermDesc">
                                                    <p>
                                                        <b>int DEV_unlink (const char *</b>
                                                        <i>path</i>
                                                        <b>);</b>
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Description</div>
                                                <div class="ModTermDesc">
                                                    <p>Remove the association of the pathname with the file. This means that the file may no longer be opened using this name, but the file may not actually be immediately removed. </p>
                                                    <p>Depending on the device, the file may be immediately removed, but for a device which allows open file descriptors to point to unlinked files, the file will not actually be deleted until the last file descriptor is closed. See <span class="crossreference"><a href="#STDZ0537704">Section 7.2.3</a></span>.</p>
                                                </div>
                                            </div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Return Value</div>
                                                <div class="ModTermDesc">
                                                    <p>This function must return -1 to indicate an error if for some reason the file could not be unlinked (delayed removal does not count as a failure to unlink.) </p>
                                                    <p>If successful, this function returns 0. </p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="ModItem">
                                            <div class="ModItemName" id="IDdev_rename">DEV_rename</div>
                                            <div class="ModItemDesc">Rename File</div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Syntax</div>
                                                <div class="ModTermDesc">
                                                    <p>
                                                        <b>int DEV_rename (const char *</b>
                                                        <i>old_name</i>
                                                        <b>, const char *</b>
                                                        <i>new_name</i>
                                                        <b>);</b>
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Description</div>
                                                <div class="ModTermDesc">
                                                    <p>This function changes the name associated with the file. </p>
                                                    <ul>
                                                        <li value="1">The <i>old_name</i> is the current name of the file.</li>
                                                        <li value="2">The <i>new_name</i> is the new name for the file.</li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Return Value</div>
                                                <div class="ModTermDesc">
                                                    <p>This function must return -1 to indicate an error if for some reason the file could not be renamed, such as the file doesn't exist, or the new name already exists. </p>
                                                    <span class="note">
                                                        <p class="note_title">NOTE</p>
                                                        <p>It is inadvisable to allow renaming a file so that it is on a different device. In general this would require a whole file copy, which may be more expensive than you expect. </p>
                                                    </span>
                                                    <p>If successful, this function returns 0. </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="subsection">
                                    <h4 id="STDZ0530925">
                                        <a MadCap:generatedBookmark="TOC" name="7.2.4_Adding_a_User-Defined_Device_Driver_for_C_I_O">
                                        </a>
                                        <span class="section-label">7.2.4 </span>Adding a User-Defined Device Driver for C I/O</h4>
                                    <p> The function add_device allows you to add and use a device. When a device is registered with add_device, the high-level I/O routines can be used for I/O on that device. </p>
                                    <p>You can use a different protocol to communicate with any desired device and install that protocol using add_device; however, the HOST functions should not be modified. The default streams stdin, stdout, and stderr can be remapped to a file on a user-defined device instead of HOST by using freopen() as in <span class="crossreference"><a href="#STDZ0532487">Example 7-1</a></span>. If the default streams are reopened in this way, the buffering mode will change to _IOFBF (fully buffered). To restore the default buffering behavior, call setvbuf on each reopened file with the appropriate value (_IOLBF for stdin and stdout, _IONBF for stderr).</p>
                                    <p>The default streams stdin, stdout, and stderr can be mapped to a file on a user-defined device instead of HOST by using freopen() as shown in <span class="crossreference"><a href="#STDZ0532487">Example 7-1</a></span>. Each function must set up and maintain its own data structures as needed. Some function definitions perform no action and should just return.</p>
                                    <div class="example">
                                        <h4 id="STDZ0532487">
                                            <a MadCap:generatedBookmark="TOC" name="Example_7-1_Mapping_Default_Streams_to_Device">
                                            </a>
                                            <span class="example-label">Example 7-1 </span>Mapping Default Streams to Device</h4>
                                        <code>#include &lt;stdio.h&gt;#include &lt;file.h&gt;#include "mydevice.h"void main()
{
 add_device("mydevice", _MSA, 
 MYDEVICE_open, MYDEVICE_close, 
 MYDEVICE_read, MYDEVICE_write, 
 MYDEVICE_lseek, MYDEVICE_unlink, MYDEVICE_rename);

 /*-----------------------------------------------------------------------*/
 /* Re-open stderr as a MYDEVICE file */
 /*-----------------------------------------------------------------------*/
 if (!freopen("mydevice:stderrfile", "w", stderr))
 { 
 puts("Failed to freopen stderr"); 
 exit(EXIT_FAILURE); 
 }

 /*-----------------------------------------------------------------------*/
 /* stderr should not be fully buffered; we want errors to be seen as */
 /* soon as possible. Normally stderr is line-buffered, but this example */
 /* doesn't buffer stderr at all. This means that there will be one call */
 /* to write() for each character in the message. */
 /*-----------------------------------------------------------------------*/
 if (setvbuf(stderr, NULL, _IONBF, 0))
 { 
 puts("Failed to setvbuf stderr"); 
 exit(EXIT_FAILURE); 
 }

 /*-----------------------------------------------------------------------*/
 /* Try it out! */
 /*-----------------------------------------------------------------------*/
 printf("This goes to stdout\n");
 fprintf(stderr, "This goes to stderr\n"); }</code>
                                    </div>
                                    <span class="note">
                                        <p class="note_title">NOTE</p>
                                        <p>
                                            <b>Use Unique Function Names</b>
                                        </p>
                                        <p>The function names open, read, write, close, lseek, rename, and unlink are used by the low-level routines. Use other names for the device-level functions that you write.</p>
                                    </span>
                                    <p>Use the low-level function add_device() to add your device to the device_table. The device table is a statically defined array that supports <i>n</i> devices, where <i>n</i> is defined by the macro _NDEVICE found in stdio.h/cstdio. </p>
                                    <p>The first entry in the device table is predefined to be the host device on which the debugger is running. The low-level routine add_device() finds the first empty position in the device table and initializes the device fields with the passed-in arguments. For a complete description, see <span class="crossreference"><a href="#IDadddev">the add_device function</a></span>.</p>
                                </div>
                                <div class="subsection">
                                    <h4 id="STDZ0535530">
                                        <a MadCap:generatedBookmark="TOC" name="7.2.5_The_device_Prefix">
                                        </a>
                                        <span class="section-label">7.2.5 </span>The device Prefix</h4>
                                    <p>A file can be opened to a user-defined device driver by using a device prefix in the pathname. The device prefix is the device name used in the call to add_device followed by a colon. For example: </p>
                                    <code>FILE *fptr = fopen("mydevice:file1", "r");
int fd = open("mydevice:file2, O_RDONLY, 0);</code>
                                    <p>If no device prefix is used, the HOST device will be used to open the file. </p>
                                    <div class="Module">
                                        <div class="ModItem">
                                            <div class="ModItemName" id="IDadddev">add_device</div>
                                            <div class="ModItemDesc">Add Device to Device Table</div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Syntax for C </div>
                                                <div class="ModTermDesc">
                                                    <p>#include &lt;file.h&gt;</p>
                                                    <p>
                                                        <b>int add_device(char *</b>
                                                        <i>name</i>,<br /> &#160;&#160;&#160;&#160;&#160;<b>unsigned </b><i>flags</i><b>, </b><br /> &#160;&#160;&#160;&#160;&#160;<b>int (*</b><i>dopen</i><b>)(const char *</b><i>path</i><b>, unsigned </b><i>flags</i><b>, int llv_fd),</b><br /> &#160;&#160;&#160;&#160;&#160;<b>int (*</b><i>dclose</i><b>)( int dev_fd),</b><br /> &#160;&#160;&#160;&#160;&#160;<b>int (*</b><i>dread</i><b>)(int</b><i>dev_fd</i><b>, char *</b><i>buf</i><b>, unsigned </b><i>count</i><b>),</b><br /> &#160;&#160;&#160;&#160;&#160;<b>int (*</b><i>dwrite</i><b>)(int</b><i>dev_fd</i><b>, const char *</b><i>buf</i><b>, unsigned </b><i>count</i><b>),</b><br /> &#160;&#160;&#160;&#160;&#160;<b>off_t (*</b><i>dlseek</i><b>)(int dev_fd, off_t </b><i>ioffset</i><b>, int </b><i>origin</i><b>),</b><br /> &#160;&#160;&#160;&#160;&#160;<b>int (*</b><i>dunlink</i><b>)(const char *</b><i>path</i><b>),</b><br /> &#160;&#160;&#160;&#160;&#160;<b>int (*</b><i>drename</i><b>)(const char *</b><i>old_name</i><b>, const char *</b><i>new_name</i><b>));</b></p>
                                                </div>
                                            </div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Defined in</div>
                                                <div class="ModTermDesc">
                                                    <p>lowlev.c (in the lib/src subdirectory of the compiler installation)</p>
                                                </div>
                                            </div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Description</div>
                                                <div class="ModTermDesc">
                                                    <p>The add_device function adds a device record to the device table allowing that device to be used for I/O from C. The first entry in the device table is predefined to be the HOST device on which the debugger is running. The function add_device() finds the first empty position in the device table and initializes the fields of the structure that represent a device.</p>
                                                    <p>To open a stream on a newly added device use fopen(&#160;) with a string of the format <i>devicename</i><b>:</b><i>filename</i> as the first argument.</p>
                                                    <ul>
                                                        <li value="1">The <i>name</i> is a character string denoting the device name. The name is limited to 8 characters.</li>
                                                        <li value="2">The <i>flags</i> are device characteristics. The flags are as follows:</li>
                                                        <p>
                                                            <b>_SSA</b> Denotes that the device supports only one open stream at a time</p>
                                                        <p>
                                                            <b>_MSA</b> Denotes that the device supports multiple open streams</p>
                                                        <p>More flags can be added by defining them in file.h.</p>
                                                        <li value="3">The <i>dopen</i>, <i>dclose</i>, <i>dread</i>, <i>dwrite</i>, <i>dlseek</i>, <i>dunlink</i>, and <i>drename</i> specifiers are function pointers to the functions in the device driver that are called by the low-level functions to perform I/O on the specified device. You must declare these functions with the interface specified in <span class="crossreference"><a href="#STDZ0532876">Section 7.2.2</a></span>. The device driver for the HOST that the <span>ARM</span> debugger is run on are included in the C I/O library.</li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Return Value</div>
                                                <div class="ModTermDesc">
                                                    <p>The function returns one of the following values: </p>
                                                    <div class="subsection">
                                                        <table class="tabbedtext">
                                                            <colgroup>
                                                                <col align="left" />
                                                                <col align="left" />
                                                            </colgroup>
                                                            <tbody>
                                                                <tr>
                                                                    <td align="left" class="noBorderRight noBorderBottom" valign="top">0</td>
                                                                    <td align="left" class="noBorderRight noBorderBottom" valign="top">if successful</td>
                                                                </tr>
                                                                <tr>
                                                                    <td align="left" class="noBorderRight noBorderBottom" valign="top">-1</td>
                                                                    <td align="left" class="noBorderRight noBorderBottom" valign="top">on failure</td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="ModItemEntry">
                                                <div class="ModItemTerm">Example</div>
                                                <div class="ModTermDesc">
                                                    <p>
                                                        <span class="crossreference">
                                                            <a href="#STDZ0533087">Example 7-2</a>
                                                        </span> does the following:</p>
                                                    <ul>
                                                        <li value="1">Adds the device <i>mydevice</i> to the device table</li>
                                                        <li value="2">Opens a file named <i>test</i> on that device and associates it with the FILE pointer <i>fid</i></li>
                                                        <li value="3">Writes the string <i>Hello, world</i> into the file</li>
                                                        <li value="4">Closes the file</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <p>
                                        <span class="crossreference">
                                            <a href="#STDZ0533087">Example 7-2</a>
                                        </span> illustrates adding and using a device for C I/O:</p>
                                    <div class="example">
                                        <h4 id="STDZ0533087">
                                            <a MadCap:generatedBookmark="TOC" name="Example_7-2_Program_for_C_I_O_Device">
                                            </a>
                                            <span class="example-label">Example 7-2 </span>Program for C I/O Device</h4>
                                        <code>#include &lt;file.h&gt;#include &lt;stdio.h&gt;/****************************************************************************/
/* Declarations of the user-defined device drivers */
/****************************************************************************/
extern int MYDEVICE_open(const char *path, unsigned flags, int fno);
extern int MYDEVICE_close(int fno);
extern int MYDEVICE_read(int fno, char *buffer, unsigned count);
extern int MYDEVICE_write(int fno, const char *buffer, unsigned count);
extern off_t MYDEVICE_lseek(int fno, off_t offset, int origin);
extern int MYDEVICE_unlink(const char *path);
extern int MYDEVICE_rename(const char *old_name, char *new_name);
main()
{
 FILE *fid;
 add_device("mydevice", _MSA, MYDEVICE_open, MYDEVICE_close, MYDEVICE_read, 
 MYDEVICE_write, MYDEVICE_lseek, MYDEVICE_unlink, MYDEVICE_rename);
 fid = fopen("mydevice:test","w");
 fprintf(fid,"Hello, world\n");
 
 fclose(fid);
}</code>
                                    </div>
                                </div>
                            </div>
                            <div class="subsection">
                                <h3 id="STDZ0739151">
                                    <a MadCap:generatedBookmark="TOC" name="7.3_Handling_Reentrancy_(_register_lock()_and__register_unlock()_Functions)">
                                    </a>
                                    <span class="section-label">7.3 </span>Handling Reentrancy (_register_lock() and _register_unlock() Functions)</h3>
                                <p> The C standard assumes only one thread of execution, with the only exception being extremely narrow support for signal handlers. The issue of reentrancy is avoided by not allowing you to do much of anything in a signal handler. However, SYS/BIOS applications have multiple threads which need to modify the same global program state, such as the CIO buffer, so reentrancy is a concern.</p>
                                <p>Part of the problem of reentrancy remains your responsibility, but the run-time-support environment does provide rudimentary support for multi-threaded reentrancy by providing support for critical sections. This implementation does not protect you from reentrancy issues<span> such as calling run-time-support functions from inside interrupts</span>; this remains your responsibility.</p>
                                <p>The run-time-support environment provides hooks to install critical section primitives. By default, a single-threaded model is assumed, and the critical section primitives are not employed. In a multi-threaded system such as SYS/BIOS, the kernel arranges to install semaphore lock primitive functions in these hooks, which are then called when the run-time-support enters code that needs to be protected by a critical section.</p>
                                <p>Throughout the run-time-support environment where a global state is accessed, and thus needs to be protected with a critical section, there are calls to the function _lock(). This calls the provided primitive, if installed, and acquires the semaphore before proceeding. Once the critical section is finished, _unlock() is called to release the semaphore.</p>
                                <p>Usually SYS/BIOS is responsible for creating and installing the primitives, so you do not need to take any action. However, this mechanism can be used in multi-threaded applications that do not use the SYS/BIOS locking mechanism.</p>
                                <p>You should not define the functions _lock() and _unlock() functions directly; instead, the installation functions are called to instruct the run-time-support environment to use these new primitives:</p>
                                <code>void _register_lock (void ( *lock)());

void _register_unlock(void (*unlock)());</code>
                                <p>The arguments to _register_lock() and _register_unlock() should be functions which take no arguments and return no values, and which implement some sort of global semaphore locking:</p>
                                <code>    extern volatile sig_atomic_t *sema = SHARED_SEMAPHORE_LOCATION;
 static int sema_depth = 0;
 static void my_lock(void) 
 { 
 while (ATOMIC_TEST_AND_SET(sema, MY_UNIQUE_ID) != MY_UNIQUE_ID); 
 sema_depth++;
 }
 static void my_unlock(void) 
 { 
 if (!--sema_depth) ATOMIC_CLEAR(sema); 
 }</code>
                                <p>The run-time-support nests calls to _lock(), so the primitives must keep track of the nesting level.</p>
                            </div>
                            <div class="subsection">
                                <h3 id="STDZ0538278">
                                    <a MadCap:generatedBookmark="TOC" name="7.4_Library-Build_Process">
                                    </a>
                                    <span class="section-label">7.4 </span>Library-Build Process</h3>
                                <p> When using the C/C++ compiler, you can compile your code under a <span>large </span>number of different configurations and options that are not necessarily compatible with one another. Because it would be infeasible to include all possible run-time-support library variants, compiler releases pre-build only a small number of very commonly-used libraries. </p>
                                <p>To provide maximum flexibility, the run-time-support source code is provided as part of each compiler release. You can build the missing libraries as desired. The linker can also automatically build missing libraries. This is accomplished with a new library build process, the core of which is the executable mklib, which is available beginning with CCS 5.1 </p>
                                <div class="subsection">
                                    <h4 id="STDZ0535560">
                                        <a MadCap:generatedBookmark="TOC" name="7.4.1_Required_Non-Texas_Instruments_Software">
                                        </a>
                                        <span class="section-label">7.4.1 </span>Required Non-Texas Instruments Software</h4>
                                    <p> To use the self-contained run-time-support build process to rebuild a library with custom options, the following are required:</p>
                                    <ul>
                                        <li value="1">sh (Bourne shell) </li>
                                        <li value="2">gmake (GNU make 3.81 or later)</li>
                                        <p>More information is available from GNU at <a href="http://www.gnu.org/software/make" target="_blank">http://www.gnu.org/software/make</a>. GNU make (gmake) is also available in earlier versions of Code Composer Studio. GNU make is also included in some UNIX support packages for Windows, such as the MKS Toolkit, Cygwin, and Interix. The GNU make used on Windows platforms should explicitly report "This program build for Windows32" when the following is executed from the Command Prompt window: </p>
                                        <code>    gmake -h</code>
                                    </ul>
                                    <p>All three of these programs are provided as a non-optional feature of CCS 5.1. They are also available as part of the optional XDC Tools feature if you are using an earlier version of CCS. </p>
                                    <p>The mklib program looks for these executables in the following order: </p>
                                    <ol>
                                        <li value="1"> in your PATH </li>
                                        <li value="2">in the directory getenv("CCS_UTILS_DIR")/cygwin </li>
                                        <li value="3">in the directory getenv("CCS_UTILS_DIR")/bin </li>
                                        <li value="4">in the directory getenv("XDCROOT") </li>
                                        <li value="5">in the directory getenv("XDCROOT")/bin </li>
                                    </ol>
                                    <p>If you are invoking mklib from the command line, and these executables are not in your path, you must set the environment variable CCS_UTILS_DIR such that getenv("CCS_UTILS_DIR")/bin contains the correct programs. </p>
                                </div>
                                <div class="subsection">
                                    <h4 id="STDZ0531726">
                                        <a MadCap:generatedBookmark="TOC" name="7.4.2_Using_the_Library-Build_Process">
                                        </a>
                                        <span class="section-label">7.4.2 </span>Using the Library-Build Process</h4>
                                    <p>You should normally let the linker automatically rebuild libraries as needed. If necessary, you can run mklib directly to populate libraries. See <span class="crossreference"><a href="#STDZ0532885">Section 7.4.2.2</a></span> for situations when you might want to do this. </p>
                                    <div class="subsection">
                                        <h4 id="STDZ0533223">
                                            <a MadCap:generatedBookmark="TOC" name="7.4.2.1_Automatic_Standard_Library_Rebuilding_by_the_Linker">
                                            </a>
                                            <span class="section-label">7.4.2.1 </span>Automatic Standard Library Rebuilding by the Linker</h4>
                                        <p>The linker looks for run-time-support libraries primarily through the <span>TI_ARM_C_DIR </span>environment variable. Typically, one of the pathnames in <span>TI_ARM_C_DIR </span>is <i>your install directory</i>/lib, which contains all of the pre-built libraries, as well as the index library libc.a. The linker looks in <span>TI_ARM_C_DIR </span> to find a library that is the best match for the build attributes of the application. The build attributes are set indirectly according to the command-line options used to build the application. Build attributes include things like CPU revision. If the library name is explicitly specified (e.g. -library=<span>rtsv4_A_be_eabi</span>), run-time support looks for that library exactly. If the library name is not specified, the linker uses the index library libc.a to pick an appropriate library. If the library is specified by path (e.g. –library=/foo/<span>rtsv4_A_be_eabi</span>), it is assumed the library already exists and it will not be built automatically.</p>
                                        <p>The index library describes a set of libraries with different build attributes. The linker will compare the build attributes for each potential library with the build attributes of the application and will pick the best fit. For details on the index library, see the archiver chapter in the <i> <span>ARM</span> Assembly Language Tools User's Guide</i>.</p>
                                        <p>Now that the linker has decided which library to use, it checks whether the run-time-support library is present in <span>TI_ARM_C_DIR </span>. The library must be in exactly the same directory as the index library libc.a. If the library is not present, the linker invokes mklib to build it. This happens when the library is missing, regardless of whether the user specified the name of the library directly or allowed the linker to pick the best library from the index library. </p>
                                        <p>The mklib program builds the requested library and places it in 'lib' directory part of <span>TI_ARM_C_DIR </span>in the same directory as the index library, so it is available for subsequent compilations. </p>
                                        <p>Things to watch out for: </p>
                                        <ul>
                                            <li value="1">The linker invokes <b>mklib</b> and waits for it to finish before finishing the link, so you will experience a one-time delay when an uncommonly-used library is built for the first time. Build times of 1-5 minutes have been observed. This depends on the power of the host (number of CPUs, etc). </li>
                                            <li value="2">In a shared installation, where an installation of the compiler is shared among more than one user, it is possible that two users might cause the linker to rebuild the same library at the same time. The <b>mklib</b> program tries to minimize the race condition, but it is possible one build will corrupt the other. In a shared environment, all libraries which might be needed should be built at install time; see <span class="crossreference"><a href="#STDZ0532885">Section 7.4.2.2</a></span> for instructions on invoking <b>mklib</b> directly to avoid this problem. </li>
                                            <li value="3">The index library must exist, or the linker is unable to rebuild libraries automatically. </li>
                                            <li value="4">The index library must be in a user-writable directory, or the library is not built. If the compiler installation must be installed read-only (a good practice for shared installation), any missing libraries must be built at installation time by invoking <b>mklib</b> directly. </li>
                                            <li value="5">The <b>mklib</b> program is specific to a certain version of a certain library; you cannot use one compiler version's run-time support's <b>mklib</b> to build a different compiler version's run-time support library. </li>
                                        </ul>
                                    </div>
                                    <div class="subsection">
                                        <h4 id="STDZ0532885">
                                            <a MadCap:generatedBookmark="TOC" name="7.4.2.2_Invoking_mklib_Manually">
                                            </a>
                                            <span class="section-label">7.4.2.2 </span>Invoking mklib Manually</h4>
                                        <p>You may need to invoke <b>mklib</b> directly in special circumstances: </p>
                                        <ul>
                                            <li value="1"> The compiler installation directory is read-only or shared.</li>
                                            <li value="2">You want to build a variant of the run-time-support library that is not pre-configured in the index library <b>libc.a</b> or known to mklib. (e.g. a variant with source-level debugging turned on.) </li>
                                        </ul>
                                        <div class="subsection">
                                            <h4 id="STDZ0531976">
                                                <a MadCap:generatedBookmark="TOC" name="7.4.2.2.1_Building_Standard_Libraries">
                                                </a>
                                                <span class="section-label">7.4.2.2.1 </span>Building Standard Libraries </h4>
                                            <p>You can invoke mklib directly to build any or all of the libraries indexed in the index library <b>libc.a</b>. The libraries are built with the standard options for that library; the library names and the appropriate standard option sets are known to mklib. </p>
                                            <p>This is most easily done by changing the working directory to be the compiler run-time-support library directory 'lib' and invoking the <b>mklib</b> executable there: </p>
                                            <code>
                                                <b>mklib --pattern=rtsv4_A_be_eabi.lib</b>
                                            </code>
                                        </div>
                                        <div class="subsection">
                                            <h4 id="STDZ0537354">
                                                <a MadCap:generatedBookmark="TOC" name="7.4.2.2.2_Shared_or_Read-Only_Library_Directory">
                                                </a>
                                                <span class="section-label">7.4.2.2.2 </span>Shared or Read-Only Library Directory</h4>
                                            <p>If the compiler tools are to be installed in shared or read-only directory, mklib cannot build the standard libraries at link time; the libraries must be built before the library directory is made shared or read-only. </p>
                                            <p>At installation time, the installing user must build all of the libraries which will be used by any user. To build all possible libraries, change the working directory to be the compiler RTS library directory 'lib' and invoke the mklib executable there: </p>
                                            <code>
                                                <b>mklib --all</b>
                                            </code>
                                            <p>Some targets have many libraries, so this step can take a long time. To build a subset of the libraries, invoke mklib individually for each desired library. </p>
                                        </div>
                                        <div class="subsection">
                                            <h4 id="STDZ0533816">
                                                <a MadCap:generatedBookmark="TOC" name="7.4.2.2.3_Building_Libraries_With_Custom_Options">
                                                </a>
                                                <span class="section-label">7.4.2.2.3 </span>Building Libraries With Custom Options </h4>
                                            <p>You can build a library with any extra custom options desired. This is useful for building a debugging version of the library, or with silicon exception workarounds enabled. The generated library is not a standard library, and must not be placed in the 'lib' directory. It should be placed in a directory local to the project which needs it. To build a debugging version of the library <span>rtsv4_A_be_eabi</span>, change the working directory to the 'lib' directory and run the command:</p>
                                            <code>
                                                <b>mklib --pattern=rtsv4_A_be_eabi.lib --name=rtsv4_A_be_eabi_debug.lib --install_to=$Project/Debug --extra_options="-g"</b>
                                            </code>
                                        </div>
                                        <div class="subsection">
                                            <h4 id="STDZ0539178">
                                                <a MadCap:generatedBookmark="TOC" name="7.4.2.2.4_The_mklib_Program_Option_Summary">
                                                </a>
                                                <span class="section-label">7.4.2.2.4 </span>The mklib Program Option Summary </h4>
                                            <p>Run the following command to see the full list of options. These are described in <span class="crossreference"><a href="#STDZ0531028">Table 7-1</a></span>.</p>
                                            <code>
                                                <b>mklib --help</b>
                                            </code>
                                            <div class="subsection">
                                                <p class="table" id="STDZ0531028">
                                                    <span class="table-label">Table 7-1 </span>The mklib Program Options </p>
                                                <table class="gentable">
                                                    <colgroup>
                                                        <col align="left" />
                                                        <col align="left" />
                                                    </colgroup>
                                                    <thead class="tbl_hdr_gray">
                                                        <tr>
                                                            <th align="left" class="noBorderRight">Option</th>
                                                            <th align="left" class="noBorderRight">Effect</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr>
                                                            <td align="left" class="noBorderRight">
                                                                <b>--index=</b>
                                                                <i>filename</i>
                                                            </td>
                                                            <td align="left" class="noBorderRight">The index library (libc.a) for this release. Used to find a template library for custom builds, and to find the source files (in the lib/src subdirectory of the compiler installation). REQUIRED.</td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" class="noBorderRight">
                                                                <b>--pattern=</b>
                                                                <i>filename</i>
                                                            </td>
                                                            <td align="left" class="noBorderRight">Pattern for building a library. If neither --extra_options nor --options are specified, the library will be the standard library with the standard options for that library. If either --extra_options or --options are specified, the library is a custom library with custom options. REQUIRED unless --all is used.</td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" class="noBorderRight">
                                                                <b>--all</b>
                                                            </td>
                                                            <td align="left" class="noBorderRight">Build all standard libraries at once.</td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" class="noBorderRight">
                                                                <b>--install_to=</b>
                                                                <i>directory</i>
                                                            </td>
                                                            <td align="left" class="noBorderRight">The directory into which to write the library. For a standard library, this defaults to the same directory as the index library (libc.a). For a custom library, this option is REQUIRED.</td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" class="noBorderRight">
                                                                <b>--compiler_bin_dir=</b>
                                                                <br />
                                                                <span>&#160;&#160;&#160;&#160;</span>
                                                                <i>directory</i>
                                                            </td>
                                                            <td align="left" class="noBorderRight">The directory where the compiler executables are. When invoking mklib directly, the executables should be in the path, but if they are not, this option must be used to tell mklib where they are. This option is primarily for use when mklib is invoked by the linker.</td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" class="noBorderRight">
                                                                <b>--name=</b>
                                                                <i>filename</i>
                                                            </td>
                                                            <td align="left" class="noBorderRight">File name for the library with no directory part. Only useful for custom libraries.</td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" class="noBorderRight">
                                                                <b>--options='</b>
                                                                <i>str</i>
                                                                <b>'</b>
                                                            </td>
                                                            <td align="left" class="noBorderRight">Options to use when building the library. The default options (see below) are <i>replaced</i> by this string. If this option is used, the library will be a custom library.</td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" class="noBorderRight">
                                                                <b> --extra_options='</b>
                                                                <i>str</i>
                                                                <b>'</b>
                                                            </td>
                                                            <td align="left" class="noBorderRight">Options to use when building the library. The default options (see below) are also used. If this option is used, the library will be a custom library.</td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" class="noBorderRight">
                                                                <b>--list_libraries</b>
                                                            </td>
                                                            <td align="left" class="noBorderRight">List the libraries this script is capable of building and exit. ordinary system-specific directory.</td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" class="noBorderRight">
                                                                <b>--log=</b>
                                                                <i>filename</i>
                                                            </td>
                                                            <td align="left" class="noBorderRight">Save the build log as <i>filename</i>.</td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" class="noBorderRight">
                                                                <b>--tmpdir=</b>
                                                                <i>directory</i>
                                                            </td>
                                                            <td align="left" class="noBorderRight">Use <i>directory</i> for scratch space instead of the ordinary system-specific directory.</td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" class="noBorderRight">
                                                                <b>--gmake=</b>
                                                                <i>filename</i>
                                                            </td>
                                                            <td align="left" class="noBorderRight">Gmake-compatible program to invoke instead of "gmake"</td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" class="noBorderRight">
                                                                <b>--parallel=</b>
                                                                <i>N</i>
                                                            </td>
                                                            <td align="left" class="noBorderRight">Compile <i>N</i> files at once ("gmake -j N").</td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" class="noBorderRight">
                                                                <b>--query=</b>
                                                                <i>filename</i>
                                                            </td>
                                                            <td align="left" class="noBorderRight">Does this script know how to build FILENAME?</td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" class="noBorderRight">
                                                                <b>--help</b> or <b>--h</b></td>
                                                            <td align="left" class="noBorderRight">Display this help.</td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" class="noBorderRight">
                                                                <b>--quiet</b> or <b>--q</b> <![CDATA[ ]]></td>
                                                            <td align="left" class="noBorderRight">Operate silently.</td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" class="noBorderRight">
                                                                <b>--verbose</b> or <b>--v</b> <![CDATA[ ]]></td>
                                                            <td align="left" class="noBorderRight">Extra information to debug this executable.</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                            <p>
                                                <b>Examples:</b>
                                            </p>
                                            <p>To build all standard libraries and place them in the compiler's library directory: </p>
                                            <code>
                                                <b>mklib --all --index=$C_DIR/lib</b>
                                            </code>
                                            <p>To build one standard library and place it in the compiler's library directory:</p>
                                            <code>
                                                <b>mklib --pattern=rtsv4_A_be_eabi.lib --index=$C_DIR/lib</b>
                                            </code>
                                            <p>To build a custom library that is just like <span>rtsv4_A_be_eabi.lib</span>, but has symbolic debugging support enabled:</p>
                                            <code>
                                                <b>mklib --pattern=rts16.lib --extra_options="-g" --index=$C_DIR/lib --install_to=$Project/Debug --name=rtsv4_A_be_eabi_debug.lib </b>
                                            </code>
                                        </div>
                                    </div>
                                </div>
                                <div class="subsection">
                                    <h4 id="STDZ0537454">
                                        <a MadCap:generatedBookmark="TOC" name="7.4.3_Extending_mklib">
                                        </a>
                                        <span class="section-label">7.4.3 </span>Extending mklib</h4>
                                    <p>The <b>mklib</b> API is a uniform interface that allows Code Composer Studio to build libraries without needing to know exactly what underlying mechanism is used to build it. Each library vendor (e.g. the TI compiler) provides a library-specific copy of 'mklib' in the library directory that can be invoked, which understands a standardized set of options, and understands how to build the library. This allows the linker to automatically build application-compatible versions of any vendor's library without needing to register the library in advance, as long as the vendor supports mklib. </p>
                                    <div class="subsection">
                                        <h4 id="STDZ0531691">
                                            <a MadCap:generatedBookmark="TOC" name="7.4.3.1_Underlying_Mechanism">
                                            </a>
                                            <span class="section-label">7.4.3.1 </span>Underlying Mechanism</h4>
                                        <p>The underlying mechanism can be anything the vendor desires. For the compiler run-time-support libraries, mklib is just a wrapper that knows how to use the files in the lib/src subdirectory of the compiler installation and invoke gmake with the appropriate options to build each library. If necessary, mklib can be bypassed and the Makefile used directly, but this mode of operation is not supported by TI, and you are responsible for any changes to the Makefile. The format of the Makefile and the interface between mklib and the Makefile is subject to change without notice. The mklib program is the forward-compatible path. </p>
                                    </div>
                                    <div class="subsection">
                                        <h4 id="STDZ0535459">
                                            <a MadCap:generatedBookmark="TOC" name="7.4.3.2_Libraries_From_Other_Vendors">
                                            </a>
                                            <span class="section-label">7.4.3.2 </span>Libraries From Other Vendors</h4>
                                        <p>Any vendor who wishes to distribute a library that can be rebuilt automatically by the linker must provide: </p>
                                        <ul>
                                            <li value="1"> An index library (like 'libc.a', but with a different name)</li>
                                            <li value="2">A copy of mklib specific to that library</li>
                                            <li value="3">A copy of the library source code (in whatever format is convenient)</li>
                                        </ul>
                                        <p>These things must be placed together in one directory that is part of the linker's library search path (specified either in <span>TI_ARM_C_DIR </span> or with the linker --search_path option). </p>
                                        <p>If mklib needs extra information that is not possible to pass as command-line options to the compiler, the vendor will need to provide some other means of discovering the information (such as a configuration file written by a wizard run from inside CCS). </p>
                                        <p>The vendor-supplied mklib must at least accept all of the options listed in <span class="crossreference"><a href="#STDZ0531028">Table 7-1</a></span> without error, even if they do not do anything. </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <a href="abstract.html">Back to Top</a>
                    <p />
                    <a href="http://www.go-dsp.com/forms/techdoc/doc_feedback.htm?litnum=SPNU151R&amp;partnum=ARM">Submit Documentation Feedback</a>
                    <p>Copyright© 2018, Texas Instruments Incorporated. An <a href="includes/important_notice.html">IMPORTANT NOTICE</a> for this document addresses availability, warranty, changes, use in safety-critical applications, intellectual property matters and other important disclaimers.</p>
                </div>
            </div>
        </div>
    </body>
</html>