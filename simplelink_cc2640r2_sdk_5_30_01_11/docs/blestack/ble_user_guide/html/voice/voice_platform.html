<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PDM Voice &mdash; 
SimpleLink™ CC2640R2 SDK
User&#39;s Guide for BLE-Stack 3.x.x
 3.03.09.00 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
      <link rel="stylesheet" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" type="text/css" />
      <link rel="stylesheet" href="../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" type="text/css" />
      <link rel="stylesheet" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Voice over BLE" href="ble_voice.html" />
    <link rel="prev" title="Creating a Voice Enabled Application" href="voice.html" />
    <script language="JavaScript">
        var tiPageName;
        tiPageName = "sug voice voice_platform";

        if (location.protocol == "file:"){
            var ci_analytics_poc_load = true;
        }
    </script>

    <script src="http://www.ti.com/assets/js/headerfooter/analytics.js" type="text/javascript" charset="utf-8"></script>


</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../ble-stack-3.x-guide/index.html" class="icon icon-home"> 
SimpleLink™ CC2640R2 SDK
User's Guide for BLE-Stack 3.x.x

          </a>
              <div class="version">
                3.03.09.00
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-3.x-guide/disclaimer.html">Disclaimer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-3.x-guide/get-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-3.x-guide/platform.html">The CC2640R2 SDK Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-3.x-guide/tirtos-index.html">TI-RTOS (RTOS Kernel) Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-3.x-guide/ble-stack-3-index.html">Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-3.x-guide/ble-stack-3-index.html#ble-stack">BLE-Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-3.x-guide/ble-stack-3-index.html#developing-a-custom-application">Developing a Custom Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-3.x-guide/ble-stack-3-index.html#ble-network-processor">BLE Network Processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-3.x-guide/ble-stack-3-index.html#running-the-sdk-on-custom-hardware">Running the SDK on Custom Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-3.x-guide/u-stack-index.html">Micro BLE Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-common/npi-index.html">Network Processor Interface (NPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-3.x-guide/index-oad-cc2640.html">Over-the-Air Download (OAD)</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="voice.html">Creating a Voice Enabled Application</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">PDM Voice</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#sampling">Sampling</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pdm-driver">PDM Driver</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#i2s-peripheral-for-pdm">I2S Peripheral for PDM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ima-adpcm-compression">IMA ADPCM Compression</a></li>
<li class="toctree-l4"><a class="reference internal" href="#driver-output">Driver Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#throughput-requirement">Throughput Requirement</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ble_voice.html">Voice over BLE</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-3.x-guide/secure-fw-index.html">Secure Firmware (SFW)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sensor-controller/sensor-controller.html">Sensor Controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-3.x-guide/debugging-index.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-3.x-guide/migration.html">Migration Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-3.x-guide/api-reference.html">API References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-3.x-guide/reference.html">Terms and Definitions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../ble-stack-3.x-guide/index.html">
SimpleLink™ CC2640R2 SDK
User's Guide for BLE-Stack 3.x.x
</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../ble-stack-3.x-guide/index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="voice.html">Creating a Voice Enabled Application</a> &raquo;</li>
      <li>PDM Voice</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="pdm-voice">
<h1>PDM Voice<a class="headerlink" href="#pdm-voice" title="Permalink to this headline">¶</a></h1>
<p>No external codec is required as the bit stream from a digital microphone can be
read directly by the device, and the PDM stream can be processed in software.</p>
<p>The figure below shows the components required to use the TI voice solution</p>
<div class="figure align-center" id="id3">
<span id="fig-pdm-voice-block-diagram"></span><img alt="../_images/pdm_voice_blk_diagram.png" src="../_images/pdm_voice_blk_diagram.png" />
<p class="caption"><span class="caption-number">Figure 103. </span><span class="caption-text">PDM Voice Block Diagram</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
<div class="section" id="sampling">
<h2>Sampling<a class="headerlink" href="#sampling" title="Permalink to this headline">¶</a></h2>
<p>The voice solution uses the following sampling parameters:</p>
<blockquote>
<div><ul class="simple">
<li><p>Sample rate: 16kHz</p></li>
<li><p>Bit Depth: 16 bits</p></li>
</ul>
</div></blockquote>
<p>Voice quality audio is a type of audio where all information can be obtained
with a low sampling rate. Whereas the typical audible spectrum is up to 20kHz,
8kHz is more than enough for voice. 16kHz sampling rate captures all information
contained up to 8kHz.</p>
<p>The voice quality of TI’s solution has been qualified by Nuance and is sufficient
for voice recognition solutions.</p>
</div>
<div class="section" id="pdm-driver">
<h2>PDM Driver<a class="headerlink" href="#pdm-driver" title="Permalink to this headline">¶</a></h2>
<p>The PDM driver is responsible for sampling the microphone data and formatting it
for the user application to use.</p>
<ol class="arabic simple">
<li><p>Collects PDM data from a PDM data microphone sampled at 1.021MHz</p></li>
<li><p>Decimates the PDM input to a PCM data stream with a 16kHz sample rate and 16 bit resolution</p></li>
<li><p>Encodes the PCM data using a software codec based on IMA ADPCM.</p></li>
</ol>
<p>More information on the PDM driver can be found at <a class="reference external" href="../../doxygen/_p_d_m_c_c26_x_x_8h.html">PDM Driver Doxygen</a></p>
<div class="section" id="i2s-peripheral-for-pdm">
<h3>I2S Peripheral for PDM<a class="headerlink" href="#i2s-peripheral-for-pdm" title="Permalink to this headline">¶</a></h3>
<p>The PDM driver uses the I2S hardware module within the CC2640R2 to sample the
PDM microphone. I2S was selected because it is a high performance peripheral
capable of generating the waveforms required for PDM sampling.</p>
<p>More information on the I2S peripheral can be found in the <a class="reference external" href="http://www.ti.com/lit/pdf/swcu117">CC13x0 CC26x0 SimpleLink Wireless MCU Technical Reference Manual</a>.</p>
<p>The (PDM specific) I2S driver layer is implemented within the PDM Util layer.
See the <a class="reference external" href="../../doxygen/_p_d_m_c_c26_x_x__util_8h.html">PDM Util Doxygen</a>
for more information.</p>
<p>A three wire interface is used to interface to the PDM mic.
See <a class="reference internal" href="#fig-pdm-voice-block-diagram"><span class="std std-ref">PDM Voice Block Diagram</span></a> for more info.</p>
<blockquote>
<div><ul class="simple">
<li><p>GPIO: Mic power</p></li>
<li><p>BCLK: Audio clock signal</p></li>
<li><p>ADx: PDM input stream from mic</p></li>
</ul>
</div></blockquote>
<p>The settings for the I2S peripheral are initialzed in <a class="reference external" href="../../../tidrivers/doxygen/html/PDMCC26XX__util_8h.html#a8168bcdab9f1e46c26823555df6f797f">PDMCC26XX_I2S_open()</a>.
The default I2S settings will work out of the box for PDM sampling.
Advanced applications of the driver may require changes that are out of the scope
of this document.</p>
<p>The GPIO pin that powers the mic is set within by the <a class="reference external" href="../../../tidrivers/doxygen/html/structPDMCC26XX__HWAttrs.html">PDMCC26XX_HWAttrs</a>,
this is generally set within the board file.</p>
</div>
<div class="section" id="ima-adpcm-compression">
<h3>IMA ADPCM Compression<a class="headerlink" href="#ima-adpcm-compression" title="Permalink to this headline">¶</a></h3>
<p>If <code class="docutils literal notranslate"><span class="pre">applyCompression</span></code> is enabled in the <a class="reference external" href="../../../tidrivers/doxygen/html/structPDMCC26XX__Params.html">PDMCC26XX_Params</a>
then the PDM driver will use the IMA ADPCM codec implementation bundled with the
driver.</p>
<p>This sample implementation can be found within the <a class="reference external" href="../../doxygen/_codec1_8h.html">TI IMA ADPCM Codec Doxygen</a> files.
Note that the TI codec includes implementation for the decode algorithms,
which can be used on voice receiver devices.</p>
<div class="section" id="pdm-driver-metadata">
<span id="sect-pdm-driver-metadata"></span><h4>PDM Driver Metadata<a class="headerlink" href="#pdm-driver-metadata" title="Permalink to this headline">¶</a></h4>
<p>When using the ADPCM codec the driver will append metadata to each frame
before sending it to the application. This metadata is used to ensure data
integrity.</p>
<p>ADPCM is a differential compression format. This means that each sample depends
on the previous. The metadata provides the information contained in the last
sample of the previous frame. So, if a frame is lost then it will not affect the
next frame. See <a class="reference external" href="../../../tidrivers/doxygen/html/structPDMCC26XX__metaData.html">PDMCC26XX_metaData</a> for more information.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 32%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>uint8_t</p></td>
<td><p>Sequence Number</p></td>
</tr>
<tr class="row-odd"><td><p>int8_t</p></td>
<td><p>Step Index (SI)</p></td>
</tr>
<tr class="row-even"><td><p>int16_t</p></td>
<td><p>Predicted Value (PV)</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="driver-output">
<h3>Driver Output<a class="headerlink" href="#driver-output" title="Permalink to this headline">¶</a></h3>
<p>The driver outputs configurable length frames.</p>
<p>Frame length can be modified to fit the chosen RF protocol. The driver defaults
to 192 samples per frame.</p>
<p>At default settings, the PDM driver produces frames that are <code class="docutils literal notranslate"><span class="pre">12ms</span></code> long.</p>
<p><code class="docutils literal notranslate"><span class="pre">(192</span> <span class="pre">S)</span> <span class="pre">/</span> <span class="pre">(16</span> <span class="pre">kS/s)</span> <span class="pre">=</span> <span class="pre">12ms</span></code></p>
</div>
<div class="section" id="throughput-requirement">
<span id="general-throughput-requirement"></span><h3>Throughput Requirement<a class="headerlink" href="#throughput-requirement" title="Permalink to this headline">¶</a></h3>
<p>Now that we know what the driver output we can calculate the required throughput.
By this we mean how many bits per second is produced by the driver.
Let us use the typical configuration with 192 samples per frame.
Recall that 192 samples per frame means a frame duration of 12ms.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 42%" />
<col style="width: 42%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Data</p></th>
<th class="head"><p>Calculation</p></th>
<th class="head"><p>rate</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Raw</p></td>
<td><p>(16000 S / s) * (16 bits / S)</p></td>
<td><p>256kbps</p></td>
</tr>
<tr class="row-odd"><td><p>Compressed</p></td>
<td><p>256kbps / 4</p></td>
<td><p>64kbps</p></td>
</tr>
<tr class="row-even"><td><p>Metadata</p></td>
<td><p>4 B / 12ms</p></td>
<td><p>2.67kbps</p></td>
</tr>
<tr class="row-odd"><td><p>Compressed frame with metadata</p></td>
<td><p>64kbps + 2.667kbps</p></td>
<td><p>66.67kpbs</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="voice.html" class="btn btn-neutral float-left" title="Creating a Voice Enabled Application" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ble_voice.html" class="btn btn-neutral float-right" title="Voice over BLE" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2010-2024, Texas Instruments.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>