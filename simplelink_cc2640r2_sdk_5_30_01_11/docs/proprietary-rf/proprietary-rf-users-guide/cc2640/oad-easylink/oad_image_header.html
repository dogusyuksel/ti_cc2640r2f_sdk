<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Image Metadata &mdash; 
SimpleLink™ CC2640R2 SDK
Proprietary RF User&#39;s Guide
 2.70.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Off-Chip OAD" href="oad_offchip.html" />
    <link rel="prev" title="Firmware update process" href="oad_process.html" />
    <script language="JavaScript">
        var tiPageName;
        tiPageName = "sug cc2640 oad-easylink oad_image_header";

        if (location.protocol == "file:"){
            var ci_analytics_poc_load = true;
        }
    </script>

    <script src="http://www.ti.com/assets/js/headerfooter/analytics.js" type="text/javascript" charset="utf-8"></script>


</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../proprietary-rf-guide/index-cc2640.html" class="icon icon-home"> 
SimpleLink™ CC2640R2 SDK
Proprietary RF User's Guide

          </a>
              <div class="version">
                2.70.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../proprietary-rf-guide/quickstart-cc2640.html">Proprietary RF Quick Start Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../proprietary-rf-guide/index-platform-cc2640.html">The SimpleLink CC2640R2 SDK Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../proprietary-rf-guide/examples-cc2640.html">Examples User’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../proprietary-rf-guide/custom-hardware.html">Custom Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../proprietary-rf-guide/tirtos-index.html">TI-RTOS (RTOS Kernel) Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../proprietary-rf-guide/nortos-index.html">noRTOS Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../proprietary-rf-guide/rf-core-index.html">RF Core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../proprietary-rf-guide/proprietary-rf-index-cc2640.html">Proprietary Physical Layer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../proprietary-rf-guide/easylink-index.html">EasyLink Layer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../proprietary-rf-guide/debugging-index.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../proprietary-rf-guide/memory-index.html">Memory overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="oad.html">Over the Air Download (OAD)</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="oad_overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="oad_process.html">Firmware update process</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Image Metadata</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#crc-and-crc-shadow">CRC and CRC Shadow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#version">Version</a></li>
<li class="toctree-l3"><a class="reference internal" href="#length">Length</a></li>
<li class="toctree-l3"><a class="reference internal" href="#user-identification-uid">User Identification (UID)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#start-address">Start Address</a></li>
<li class="toctree-l3"><a class="reference internal" href="#image-type">Image Type</a></li>
<li class="toctree-l3"><a class="reference internal" href="#image-state">Image State</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="oad_offchip.html">Off-Chip OAD</a></li>
<li class="toctree-l2"><a class="reference internal" href="oad_onchip.html">On-Chip OAD</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../proprietary-rf-guide/migration-cc2640.html">Migration Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../proprietary-rf-guide/reference-cc2640.html">API References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../proprietary-rf-guide/glossary-cc2640.html">Terms and acronyms</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../proprietary-rf-guide/index-cc2640.html">
SimpleLink™ CC2640R2 SDK
Proprietary RF User's Guide
</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../proprietary-rf-guide/index-cc2640.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="oad.html">Over the Air Download (OAD)</a> &raquo;</li>
      <li>Image Metadata</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="image-metadata">
<h1>Image Metadata<a class="headerlink" href="#image-metadata" title="Permalink to this headline">¶</a></h1>
<p>All TI OAD images use a 16-byte metadata header. This metadata vector is
embedded at the beginning of the image, occupying the first 16 bytes before
the application code. Metadata checking is done in
<code class="code docutils literal notranslate"><span class="pre">OADTarget_validateNewImage()</span></code>. <a class="reference internal" href="#tbl-metadata-description-table"><span class="std std-numref">Table 15.</span></a>
below shows a description of the metadata vector.</p>
<span id="tbl-metadata-description-table"></span><table class="docutils align-default" id="id3">
<caption><span class="caption-number">Table 15. </span><span class="caption-text">Description of the metadata vector.</span><a class="headerlink" href="#id3" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 24%" />
<col style="width: 26%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Size (in bytes)</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>CRC</p></td>
<td><p>2</p></td>
<td><p>Cyclic Redundancy Check (CRC)</p></td>
</tr>
<tr class="row-odd"><td><p>CRC Shadow</p></td>
<td><p>2</p></td>
<td><p>Place holder for CRC</p></td>
</tr>
<tr class="row-even"><td><p>Version</p></td>
<td><p>2</p></td>
<td><p>Version</p></td>
</tr>
<tr class="row-odd"><td><p>Length</p></td>
<td><p>2</p></td>
<td><p>Length of the image in words*</p></td>
</tr>
<tr class="row-even"><td><p>UID</p></td>
<td><p>4</p></td>
<td><p>User Identification</p></td>
</tr>
<tr class="row-odd"><td><p>Start Address</p></td>
<td><p>2</p></td>
<td><p>The destination address of the
image in words*</p></td>
</tr>
<tr class="row-even"><td><p>Image Type</p></td>
<td><p>1</p></td>
<td><p>The type of image to be downloaded</p></td>
</tr>
<tr class="row-odd"><td><p>State</p></td>
<td><p>1</p></td>
<td><p>The status of this image</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The above fields that are marked with an asterisk * are
measured in 32-bit words. For example, an image length of 0x100
describes an image that is 1024 bytes in size. The OAD word size is
defined by <code class="code docutils literal notranslate"><span class="pre">EFL_OAD_ADDR_RESOLUTION</span></code> for off-chip OAD and by
<code class="code docutils literal notranslate"><span class="pre">HAL_FLASH_WORD_SIZE</span></code> for on-chip OAD.</p>
</div>
<div class="section" id="crc-and-crc-shadow">
<h2>CRC and CRC Shadow<a class="headerlink" href="#crc-and-crc-shadow" title="Permalink to this headline">¶</a></h2>
<p>The cyclic redundancy check (CRC) is a means to check the integrity of an
image. This must be done in two steps. First the CRC must be calculated when
the image is generated from the toolchain, this will be stored in the CRC
field within the metadata vector.</p>
<p>This initial CRC will be sent over the air via the OAD service. Later, the
target will need to ensure that the image has not been corrupted during
transfer. The target will then re-calculate the CRC of the downloaded image;
this will be stored in the CRC shadow field of the metadata vector.</p>
<p>If the CRC and CRC shadow are equivalent, the target can assume that the
image was not corrupted while sending over the air.</p>
<p>The algorithm selected for CRC calculations is the <a class="reference external" href="https://en.wikipedia.org/wiki/Cyclic_redundancy_check#Standards_and_common_use">CRC-16-CCITT</a>.</p>
</div>
<div class="section" id="version">
<h2>Version<a class="headerlink" href="#version" title="Permalink to this headline">¶</a></h2>
<p>The image version field is used to track revisions of images and ensure
upgrade compatibility. Customers may implement their own versioning
scheme; however, there are additional checks imposed by the TI OAD profile.
See the function <code class="code docutils literal notranslate"><span class="pre">OADTarget_validateNewImage()</span></code> within
<code class="code docutils literal notranslate"><span class="pre">oad_target_external_flash.c</span></code> or  <code class="code docutils literal notranslate"><span class="pre">oad_target_internal_flash.c</span></code>
how these version checks are done in Off-chip and On-chip OAD, respectively.</p>
</div>
<div class="section" id="length">
<h2>Length<a class="headerlink" href="#length" title="Permalink to this headline">¶</a></h2>
<p>The length field is the length of the image in words, where the word
size is defined by <code class="code docutils literal notranslate"><span class="pre">EFL_OAD_ADDR_RESOLUTION</span></code> and <code class="code docutils literal notranslate"><span class="pre">HAL_FLASH_WORD_SIZE</span></code>
for On-chip and Off-chip OAD respectively. Off-chip OAD customers who
are using different external flash parts may need to modify
<code class="code docutils literal notranslate"><span class="pre">EFL_OAD_ADDR_RESOLUTION</span></code> to match the word size of their part. For
On-chip OAD, the word size of the CC2640R2 is fixed.</p>
</div>
<div class="section" id="user-identification-uid">
<h2>User Identification (UID)<a class="headerlink" href="#user-identification-uid" title="Permalink to this headline">¶</a></h2>
<p>This field is un-used by the TI OAD profile in the BLE stack only, but the
hooks are in place for a customer to add their own implementation of verifying
images based on a UID.</p>
<p>For on-chip OAD, the convention is that Image A will embed ‘A’, ‘A’,
‘A’, ‘A’ and Image B will embed ‘B’, ‘B’, ‘B’, ‘B’. Off-chip images use
‘E’, ‘E’, ‘E’, ‘E’ by default.</p>
</div>
<div class="section" id="start-address">
<h2>Start Address<a class="headerlink" href="#start-address" title="Permalink to this headline">¶</a></h2>
<p>The start address is the first address where the proposed image is to be
stored in internal flash. Similar to the length field, this is
calculated in words. Off-chip OAD solutions put restrictions on the
start address based on image type (more on this in the next section).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For On-chip OAD solutions, this field is reserved in the
metadata as they use a fixed start address that is based on the internal
flash memory map.</p>
</div>
</div>
<div class="section" id="image-type">
<h2>Image Type<a class="headerlink" href="#image-type" title="Permalink to this headline">¶</a></h2>
<p>In Off-chip OAD systems with external flash, there are multiple types of
images that can be uploaded. They are explained in <a class="reference internal" href="#tbl-off-chip-oad-image-types"><span class="std std-numref">Table 16.</span></a>.
Note, that OAD via EasyLink supports only <cite>Application</cite> type as there are no
stacks involved.</p>
<span id="tbl-off-chip-oad-image-types"></span><table class="docutils align-default" id="id4">
<caption><span class="caption-number">Table 16. </span><span class="caption-text">Off-chip OAD Image Types.</span><a class="headerlink" href="#id4" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 44%" />
<col style="width: 13%" />
<col style="width: 43%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Image Type</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>EFL_OAD_IMG_TYPE_APP</p></td>
<td><p>1</p></td>
<td><p>An application or application
+ stack merged update</p></td>
</tr>
<tr class="row-odd"><td><p>EFL_OAD_IMG_TYPE_STACK</p></td>
<td><p>2</p></td>
<td><p>A stack only update</p></td>
</tr>
<tr class="row-even"><td><p>EFL_OAD_IMG_TYPE_NP</p></td>
<td><p>3</p></td>
<td><dl class="simple">
<dt>A network processor update.</dt><dd><p>This only applies to the
SimpleAP + SimpleNP demo</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td><p>EFL_OAD_IMG_TYPE_FACTORY</p></td>
<td><p>4</p></td>
<td><p>Describes the permanently
resident production image that
runs on the device before any
OTA updates.</p></td>
</tr>
</tbody>
</table>
<p>On-chip OAD solutions determine the image type based on the LSB of the image
version field. The image type field is not used in this case.</p>
</div>
<div class="section" id="image-state">
<h2>Image State<a class="headerlink" href="#image-state" title="Permalink to this headline">¶</a></h2>
<p>The image state is a one byte metadata field that is used only by
Off-chip OAD solutions. The state informs the bootloader whether or not
the image is ready to run or currently running. This prevents the
bootloader from copying the same image from external to internal flash
on every boot.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For On-chip OAD solutions this field is reserved in the
metadata as the OAD reset service handles switching between images in
the bootloader.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="oad_process.html" class="btn btn-neutral float-left" title="Firmware update process" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="oad_offchip.html" class="btn btn-neutral float-right" title="Off-Chip OAD" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2024, Texas Instruments.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>